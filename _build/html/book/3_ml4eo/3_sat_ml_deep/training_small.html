
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Semantic segmentation of Aerial Imaginary with U-Net-like architectures &#8212; SENSE Training Resources</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/3_ml4eo/3_sat_ml_deep/training_small';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/Sense-logo-4_transpCol-1024x431.png" class="logo__image only-light" alt="SENSE Training Resources - Home"/>
    <script>document.write(`<img src="../../../_static/Sense-logo-4_transpCol-1024x431.png" class="logo__image only-dark" alt="SENSE Training Resources - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Book 1 - Python Software Carpentry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../1_python_zero2hero/book1_overview.html">0 - Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../1_python_zero2hero/1_intro.html">1 - Intro to Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/1_intro/00-Introduction.html">1.0 Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/1_intro/01-How-to-Run-Python-Code.html">1.1 How to Run Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/1_intro/02-Jupyter-Notebook.html">1.2 Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/1_intro/03-Basic-Python-Syntax.html">1.3 Python Language Syntax</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics.html">2 - Python Basics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/01-Semantics-Variables.html">2.1 Variables and Objects in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/02-Semantics-Operators.html">2.2 Basic Python Semantics: Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/03-Built-in-Scalar-Types.html">2.3 Built-In Types: Simple Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/04-Built-in-Data-Structures.html">2.4 Built-In Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/05-Ex-Try-Python-Basics.html">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/06-Control-Flow-Statements.html">2.5 Control Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/07-Defining-Functions.html">2.6 Defining and Using Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/2_python_basics/09-Modules-and-Packages.html">Modules and Packages</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation.html">3 - Plotting</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation/01-Numpy-Intro.html"> Introduction to NumPy</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation/02-Matplotlib.html">Matplotlib - Intro</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation/03-Working-with-datetime.html">Working with dates and times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation/04-Pandas-Intro.html">Introduction to pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1_python_zero2hero/3_data_analysis_visualisation/05-Plotting-with-Seaborn.html">Statistical plotting with Seaborn</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Book 2 - GeoPython</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../2_geo_python/book2_overview.html">0 - Overview</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools.html">1 - GeoPython Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/00_intro_to_geospatial_data.html">Introduction to Geospatial Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/cartopy.html">Cartopy</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/geopandas.html">GeoPandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/rasterio.html">Rasterio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/rioxarray.html">Rioxarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/xarray.html">Xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/1_spatial_data_tools/20-Xarray-NetCDF-Intro.html">Working with NetCDF files</a></li>








</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../2_geo_python/2_eo_data.html">2 - EO data</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../2_geo_python/3_gee_python.html">3 - GEE Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/3_gee_python/0_First_steps.html">Linking Google Colab to your GitHub page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/3_gee_python/1_Open_and_display.html">Google Earth Engine: JavaScript, but Python</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../2_geo_python/3_gee_python/2_Time_series.html">ImageCollection</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Book 3 - Machine Learning for EO</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book3_overview.html">0 - Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2_sat_ml_intro.html">2 - Classical ML with satellite data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../2_sat_ml_intro/1_linear_regression.html">Practical 1: Linear Regression</a></li>





<li class="toctree-l2"><a class="reference internal" href="../2_sat_ml_intro/2_classification.html">Practical 2: Classification</a></li>


<li class="toctree-l2"><a class="reference internal" href="../2_sat_ml_intro/3_kalman_filter.html">Practical 3: Kalman Filter</a></li>


</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3_sat_ml_deep.html">3 - Deep Learning with PyTorch</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="00_intro.html">Satellite image deep learning with PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_segmentation_unet.html">Semantic segmentation of Aerial Imaginary with U-Net-like architectures</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../4_embeddings.html">4 - Embeddings</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../4_embeddings/notebooks/1a_Use_PCA_analysis_to_study_tile_embeddings.html">Use PCA analysis on tile embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4_embeddings/notebooks/1b_Exploring_embedding_space_with_clustering_methods.html">How are the study tiles clustered in the embedding space?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4_embeddings/notebooks/2_Working_with_your_own_data.html">Working with your own input data</a></li>

</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/leamhowe/sense-jb/blob/main/book/book/3_ml4eo/3_sat_ml_deep/training_small.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/leamhowe/sense-jb" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/leamhowe/sense-jb/issues/new?title=Issue%20on%20page%20%2Fbook/3_ml4eo/3_sat_ml_deep/training_small.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/book/3_ml4eo/3_sat_ml_deep/training_small.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Semantic segmentation of Aerial Imaginary with U-Net-like architectures</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-notebook-is-a-simple-semantic-segmentation-program-the-goal-is-to-build-and-train-a-model-which-is-able-to-automatically-label-each-pixel-in-an-aerial-image-with-its-semantic-category">This notebook is a simple semantic segmentation program. The goal is to build and train a model which is able to automatically label each pixel in an aerial image with its semantic category.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-dataset-we-use-consists-of-aerial-imagery-of-dubai-obtained-by-mbrsc-satellites-and-annotated-with-pixel-wise-semantic-segmentation-in-6-classes-the-total-volume-of-the-dataset-is-1305-256-256-images-grouped-into-6-larger-tiles-the-classes-are-building-land-unpaved-area-road-vegetation-water-unlabeled">The dataset we use consists of aerial imagery of Dubai obtained by MBRSC satellites and annotated with pixel-wise semantic segmentation in 6 classes. The total volume of the dataset is 1305 256*256 images grouped into 6 larger tiles. The classes are: Building, Land (unpaved area), Road, Vegetation, Water, Unlabeled.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-gpu">Run on GPU</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-python-library">Install Python library</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-dataset-from-github">Download Dataset from GitHub</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-current-working-directory">Set the Current Working Directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-train-validation-test-images-from-corresponding-subdirectory">Read train/ validation/ test images from corresponding subdirectory.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-array-integer-values-for-each-pixel-from-npy-file-to-be-used-as-labels">Read array (integer values for each pixel) from .npy file,  to be used as labels.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-model-u-net-based-model">Define the model: U-Net based model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-plotting-utilities">Model plotting utilities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configures-the-model-for-training">Configures the model for training.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-the-model-for-a-fixed-number-of-epochs-iterations-on-a-dataset">Train the model for a fixed number of epochs (iterations on a dataset).</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-training-and-validation-accuracy-and-loss-at-each-epoch">Plot the training and validation accuracy and loss at each epoch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-predictions">Visualize predictions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-1-finetune-the-segmentation-model">Exercises 1. Finetune the segmentation model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-2-try-another-model">Exercises 2.Try another model</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Original author: David Hogg <br />
Adapted for SENSE use by: Leam Howe</p>
<section class="tex2jax_ignore mathjax_ignore" id="semantic-segmentation-of-aerial-imaginary-with-u-net-like-architectures">
<h1><strong>Semantic segmentation of Aerial Imaginary with U-Net-like architectures</strong><a class="headerlink" href="#semantic-segmentation-of-aerial-imaginary-with-u-net-like-architectures" title="Link to this heading">#</a></h1>
<section id="this-notebook-is-a-simple-semantic-segmentation-program-the-goal-is-to-build-and-train-a-model-which-is-able-to-automatically-label-each-pixel-in-an-aerial-image-with-its-semantic-category">
<h2>This notebook is a simple semantic segmentation program. The goal is to build and train a model which is able to automatically label each pixel in an aerial image with its semantic category.<a class="headerlink" href="#this-notebook-is-a-simple-semantic-segmentation-program-the-goal-is-to-build-and-train-a-model-which-is-able-to-automatically-label-each-pixel-in-an-aerial-image-with-its-semantic-category" title="Link to this heading">#</a></h2>
</section>
<section id="the-dataset-we-use-consists-of-aerial-imagery-of-dubai-obtained-by-mbrsc-satellites-and-annotated-with-pixel-wise-semantic-segmentation-in-6-classes-the-total-volume-of-the-dataset-is-1305-256-256-images-grouped-into-6-larger-tiles-the-classes-are-building-land-unpaved-area-road-vegetation-water-unlabeled">
<h2>The dataset we use consists of aerial imagery of Dubai obtained by MBRSC satellites and annotated with pixel-wise semantic segmentation in 6 classes. The total volume of the dataset is 1305 256*256 images grouped into 6 larger tiles. The classes are: Building, Land (unpaved area), Road, Vegetation, Water, Unlabeled.<a class="headerlink" href="#the-dataset-we-use-consists-of-aerial-imagery-of-dubai-obtained-by-mbrsc-satellites-and-annotated-with-pixel-wise-semantic-segmentation-in-6-classes-the-total-volume-of-the-dataset-is-1305-256-256-images-grouped-into-6-larger-tiles-the-classes-are-building-land-unpaved-area-road-vegetation-water-unlabeled" title="Link to this heading">#</a></h2>
</section>
<section id="run-on-gpu">
<h2>Run on GPU<a class="headerlink" href="#run-on-gpu" title="Link to this heading">#</a></h2>
<p>For model runtime speed, check Collab is running on GPU.</p>
<p>Click the “<strong>Runtime</strong>” dropdown menu. Select “<strong>Change runtime type</strong>”. Now select ‘<strong>GPU</strong>’ in the “<strong>Hardware accelerator</strong>” dropdown menu.</p>
</section>
<section id="install-python-library">
<h2>Install Python library<a class="headerlink" href="#install-python-library" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">segmentation-models</span></code>: with Neural Networks for Image Segmentation based on Keras and TensorFlow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>segmentation-models
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: segmentation-models in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (1.0.1)
Requirement already satisfied: keras-applications&lt;=1.0.8,&gt;=1.0.7 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from segmentation-models) (1.0.8)
Requirement already satisfied: image-classifiers==1.0.0 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from segmentation-models) (1.0.0)
Requirement already satisfied: efficientnet==1.0.0 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from segmentation-models) (1.0.0)
Requirement already satisfied: scikit-image in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from efficientnet==1.0.0-&gt;segmentation-models) (0.24.0)
Requirement already satisfied: numpy&gt;=1.9.1 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from keras-applications&lt;=1.0.8,&gt;=1.0.7-&gt;segmentation-models) (2.0.2)
Requirement already satisfied: h5py in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from keras-applications&lt;=1.0.8,&gt;=1.0.7-&gt;segmentation-models) (3.12.1)
Requirement already satisfied: scipy&gt;=1.9 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (1.13.1)
Requirement already satisfied: networkx&gt;=2.8 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (3.2.1)
Requirement already satisfied: pillow&gt;=9.1 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (11.1.0)
Requirement already satisfied: imageio&gt;=2.33 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (2.37.0)
Requirement already satisfied: tifffile&gt;=2022.8.12 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (2024.6.18)
Requirement already satisfied: packaging&gt;=21 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (24.2)
Requirement already satisfied: lazy-loader&gt;=0.4 in /exports/csce/datastore/geos/users/s2112771/miniforge3/envs/tf-env/lib/python3.9/site-packages (from scikit-image-&gt;efficientnet==1.0.0-&gt;segmentation-models) (0.4)
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-dataset-from-github">
<h2>Download Dataset from GitHub<a class="headerlink" href="#download-dataset-from-github" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">git-clone</span></code> - Clone a repository into a new directory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lfj95/SENSE2023.git
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fatal: destination path &#39;SENSE2023&#39; already exists and is not an empty directory.
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-packages">
<h2>Import Packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">keras</span><span class="w"> </span><span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras</span><span class="w"> </span><span class="kn">import</span> <span class="n">layers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.optimizers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Adam</span><span class="p">,</span> <span class="n">SGD</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeanIoU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_model</span>
<span class="o">%</span><span class="k">env</span> SM_FRAMEWORK=tf.keras
<span class="kn">import</span><span class="w"> </span><span class="nn">segmentation_models</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-07 11:58:01.688649: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-03-07 11:58:03.523884: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1741348684.404942 1590473 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1741348684.520774 1590473 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2025-03-07 11:58:06.219084: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>env: SM_FRAMEWORK=tf.keras
Segmentation Models: using `tf.keras` framework.
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-current-working-directory">
<h2>Set the Current Working Directory<a class="headerlink" href="#set-the-current-working-directory" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">makedir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>

<span class="n">label_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/SENSE2023/split_data/labels.npy&quot;</span>
<span class="n">train_data_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/SENSE2023/split_data/train/images&quot;</span>
<span class="n">valid_data_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/SENSE2023/split_data/valid/images&quot;</span>
<span class="n">test_data_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/SENSE2023/split_data/test/images&quot;</span>
<span class="n">save_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/models&quot;</span>
<span class="n">makedir</span><span class="p">(</span><span class="n">save_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-train-validation-test-images-from-corresponding-subdirectory">
<h2>Read train/ validation/ test images from corresponding subdirectory.<a class="headerlink" href="#read-train-validation-test-images-from-corresponding-subdirectory" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">read_image</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
  <span class="n">image_dataset</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">images</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1">#List of all image names in this subdirectory</span>
  <span class="n">images</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>  
      <span class="k">if</span> <span class="n">image_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>   <span class="c1">#Only read jpg images...</span>
          <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">image_name</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">#Read each image as BGR</span>
          <span class="n">image_dataset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">image_dataset</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">read_image</span><span class="p">(</span><span class="n">train_data_directory</span><span class="p">))</span>
<span class="n">X_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">read_image</span><span class="p">(</span><span class="n">valid_data_directory</span><span class="p">))</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">read_image</span><span class="p">(</span><span class="n">test_data_directory</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train Images size:&quot;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;Validation Images size:&quot;</span><span class="p">,</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;Test Images size:&quot;</span><span class="p">,</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train Images size: (783, 256, 256, 3) 
 Validation Images size: (261, 256, 256, 3) 
 Test Images size: (261, 256, 256, 3)
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-array-integer-values-for-each-pixel-from-npy-file-to-be-used-as-labels">
<h2>Read array (integer values for each pixel) from .npy file,  to be used as labels.<a class="headerlink" href="#read-array-integer-values-for-each-pixel-from-npy-file-to-be-used-as-labels" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.**</span><span class="n">to_categorical</span><span class="o">**</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Converts a class vector (integers) to binary class matrix, e.g., for use with categorical_crossentropy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict_load</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">label_directory</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">labels_train</span> <span class="o">=</span> <span class="n">dict_load</span><span class="o">.</span><span class="n">item</span><span class="p">()[</span><span class="s1">&#39;labels_train&#39;</span><span class="p">]</span>
<span class="n">labels_valid</span> <span class="o">=</span> <span class="n">dict_load</span><span class="o">.</span><span class="n">item</span><span class="p">()[</span><span class="s1">&#39;labels_valid&#39;</span><span class="p">]</span>
<span class="n">labels_test</span> <span class="o">=</span> <span class="n">dict_load</span><span class="o">.</span><span class="n">item</span><span class="p">()[</span><span class="s1">&#39;labels_test&#39;</span><span class="p">]</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_train</span><span class="p">))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_categorical</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">labels_train</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">)</span>
<span class="n">y_valid</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">labels_valid</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">labels_test</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-model-u-net-based-model">
<h2>Define the model: U-Net based model<a class="headerlink" href="#define-the-model-u-net-based-model" title="Link to this heading">#</a></h2>
<p>The model we defined consists of a contracting path and an expansive path.</p>
<ul class="simple">
<li><p>The contracting path follows the typical architecture of a convolutional network. It consists of the repeated application of two 3x3 convolutions, each followed by a rectified linear unit (ReLU) and a 2x2 max pooling operation with stride 2 for downsampling.</p></li>
<li><p>At each downsampling step we double the number of feature channels. Every step in the expansive path consists of an upsampling of the feature map followed by a 2x2 convolution (“up-convolution”) that halves the number of feature channels, a concatenation with the correspondingly cropped feature map from the contracting path, and two 3x3 convolutions, each followed by a ReLU.</p></li>
</ul>
<p>At the final layer, a 1x1 convolution is used to map each 64-component feature vector to the desired number of classes.</p>
<p>Layers used:</p>
<ol class="arabic simple">
<li><p><strong>Conv2D</strong></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dilation_rate</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s2">&quot;glorot_uniform&quot;</span><span class="p">,</span> <span class="n">bias_initializer</span><span class="o">=</span><span class="s2">&quot;zeros&quot;</span><span class="p">,</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bias_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">activity_regularizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kernel_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bias_constraint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>MaxPooling2D</strong></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p><strong>UpSampling2D</strong></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">UpSampling2D</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">data_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>interpolation:	A string, one of ‘nearest’ or ‘bilinear’.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  unet mini</span>

<span class="n">num_classes</span><span class="o">=</span><span class="mi">6</span>
<span class="n">IMG_HEIGHT</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_WIDTH</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_CHANNELS</span><span class="o">=</span><span class="mi">3</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">((</span><span class="n">IMG_HEIGHT</span><span class="p">,</span> <span class="n">IMG_WIDTH</span><span class="p">,</span> <span class="n">IMG_CHANNELS</span><span class="p">))</span>

<span class="c1"># contracting path</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c1</span><span class="p">)</span>

<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c2</span><span class="p">)</span>  
  
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c3</span><span class="p">)</span>

<span class="c1"># expansive path</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c4</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c4</span><span class="p">)</span>
  
<span class="n">c5</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c5</span><span class="p">,</span> <span class="n">c1</span><span class="p">])</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

<span class="c1"># model.summary()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-plotting-utilities">
<h2>Model plotting utilities<a class="headerlink" href="#model-plotting-utilities" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s2">&quot;model.png&quot;</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_layer_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s2">&quot;TB&quot;</span><span class="p">,</span> <span class="n">expand_nested</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">layer_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_layer_activations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Converts a Keras model to dot format and save to a file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span> <span class="n">save_directory</span> <span class="o">+</span> <span class="s1">&#39;/small_unet1.png&#39;</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/269dcec5f0d20e42ec5bfccdeb41a1a35ed6999e3af73b7142c68ed4bd7da420.png" src="../../../_images/269dcec5f0d20e42ec5bfccdeb41a1a35ed6999e3af73b7142c68ed4bd7da420.png" />
</div>
</div>
</section>
<section id="configures-the-model-for-training">
<h2>Configures the model for training.<a class="headerlink" href="#configures-the-model-for-training" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;rmsprop&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loss_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weighted_metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_eagerly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps_per_execution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">jit_compile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><p>optimizer:	String (name of optimizer) or optimizer instance. See tf.keras.
optimizers.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>loss: 	Loss function. Maybe be a string (name of loss function), or a tf.keras.losses.Loss instance. See tf.keras.losses.</p></li>
<li><p>metrics: List of metrics to be evaluated by the model during training and testing. Each of this can be a string (name of a built-in function), function or a tf.keras.metrics.Metric instance.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">jacard_coef</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">y_true_f</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">y_pred_f</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="n">intersection</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true_f</span> <span class="o">*</span> <span class="n">y_pred_f</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">intersection</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true_f</span><span class="p">)</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_pred_f</span><span class="p">)</span> <span class="o">-</span> <span class="n">intersection</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">jacard_coef</span><span class="p">]</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">CategoricalCELoss</span><span class="p">(),</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
<span class="c1"># model.summary()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-the-model-for-a-fixed-number-of-epochs-iterations-on-a-dataset">
<h2>Train the model for a fixed number of epochs (iterations on a dataset).<a class="headerlink" href="#train-the-model-for-a-fixed-number-of-epochs-iterations-on-a-dataset" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><p>x: Input data. It could be either Numpy array(s) or TensorFlow tensor(s).</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>y: Target data. Like the input data x, it could be either Numpy array(s) or TensorFlow tensor(s). It should be consistent with x.</p></li>
<li><p>batch_size: Integer or None. Number of samples per gradient update. If unspecified, batch_size will default to 32.</p></li>
<li><p>epochs: Integer. Number of epochs to train the model. An epoch is an iteration over the entire x and y data provided</p></li>
<li><p>validation_data: Data on which to evaluate the loss and any model metrics at the end of each epoch. The model will not be trained on this data.</p></li>
<li><p>shuffle: Boolean (whether to shuffle the training data before each epoch) or str (for ‘batch’).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> 
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> 
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">),</span> 
                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/60
49/49 [==============================] - 30s 210ms/step - loss: 0.2829 - accuracy: 0.4861 - jacard_coef: 0.2664 - val_loss: 0.1779 - val_accuracy: 0.5877 - val_jacard_coef: 0.3782
Epoch 2/60
49/49 [==============================] - 7s 150ms/step - loss: 0.1788 - accuracy: 0.5781 - jacard_coef: 0.3484 - val_loss: 0.1702 - val_accuracy: 0.5926 - val_jacard_coef: 0.3721
Epoch 3/60
49/49 [==============================] - 7s 140ms/step - loss: 0.1658 - accuracy: 0.6080 - jacard_coef: 0.3714 - val_loss: 0.1575 - val_accuracy: 0.6247 - val_jacard_coef: 0.3709
Epoch 4/60
49/49 [==============================] - 7s 137ms/step - loss: 0.1578 - accuracy: 0.6425 - jacard_coef: 0.3860 - val_loss: 0.1454 - val_accuracy: 0.6747 - val_jacard_coef: 0.4234
Epoch 5/60
49/49 [==============================] - 7s 142ms/step - loss: 0.1388 - accuracy: 0.6948 - jacard_coef: 0.4369 - val_loss: 0.1244 - val_accuracy: 0.7269 - val_jacard_coef: 0.4918
Epoch 6/60
49/49 [==============================] - 7s 152ms/step - loss: 0.1280 - accuracy: 0.7094 - jacard_coef: 0.4631 - val_loss: 0.1199 - val_accuracy: 0.7366 - val_jacard_coef: 0.4931
Epoch 7/60
49/49 [==============================] - 7s 141ms/step - loss: 0.1254 - accuracy: 0.7220 - jacard_coef: 0.4738 - val_loss: 0.1164 - val_accuracy: 0.7453 - val_jacard_coef: 0.4768
Epoch 8/60
49/49 [==============================] - 8s 156ms/step - loss: 0.1213 - accuracy: 0.7286 - jacard_coef: 0.4828 - val_loss: 0.1145 - val_accuracy: 0.7448 - val_jacard_coef: 0.4943
Epoch 9/60
49/49 [==============================] - 8s 160ms/step - loss: 0.1216 - accuracy: 0.7281 - jacard_coef: 0.4828 - val_loss: 0.1093 - val_accuracy: 0.7712 - val_jacard_coef: 0.5175
Epoch 10/60
49/49 [==============================] - 8s 157ms/step - loss: 0.1145 - accuracy: 0.7515 - jacard_coef: 0.5038 - val_loss: 0.1051 - val_accuracy: 0.7762 - val_jacard_coef: 0.5162
Epoch 11/60
49/49 [==============================] - 7s 142ms/step - loss: 0.1141 - accuracy: 0.7480 - jacard_coef: 0.5027 - val_loss: 0.1032 - val_accuracy: 0.7733 - val_jacard_coef: 0.5370
Epoch 12/60
49/49 [==============================] - 7s 146ms/step - loss: 0.1092 - accuracy: 0.7627 - jacard_coef: 0.5209 - val_loss: 0.1005 - val_accuracy: 0.7864 - val_jacard_coef: 0.5394
Epoch 13/60
49/49 [==============================] - 8s 158ms/step - loss: 0.1085 - accuracy: 0.7631 - jacard_coef: 0.5201 - val_loss: 0.0976 - val_accuracy: 0.7978 - val_jacard_coef: 0.5360
Epoch 14/60
49/49 [==============================] - 7s 142ms/step - loss: 0.1075 - accuracy: 0.7670 - jacard_coef: 0.5253 - val_loss: 0.0929 - val_accuracy: 0.8049 - val_jacard_coef: 0.5826
Epoch 15/60
49/49 [==============================] - 7s 144ms/step - loss: 0.1030 - accuracy: 0.7789 - jacard_coef: 0.5374 - val_loss: 0.0964 - val_accuracy: 0.8064 - val_jacard_coef: 0.5385
Epoch 16/60
49/49 [==============================] - 7s 141ms/step - loss: 0.1044 - accuracy: 0.7792 - jacard_coef: 0.5357 - val_loss: 0.0986 - val_accuracy: 0.7948 - val_jacard_coef: 0.5781
Epoch 17/60
49/49 [==============================] - 7s 144ms/step - loss: 0.1020 - accuracy: 0.7831 - jacard_coef: 0.5459 - val_loss: 0.1026 - val_accuracy: 0.7951 - val_jacard_coef: 0.4998
Epoch 18/60
49/49 [==============================] - 7s 141ms/step - loss: 0.0997 - accuracy: 0.7919 - jacard_coef: 0.5481 - val_loss: 0.0904 - val_accuracy: 0.8219 - val_jacard_coef: 0.5686
Epoch 19/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0989 - accuracy: 0.7979 - jacard_coef: 0.5514 - val_loss: 0.0877 - val_accuracy: 0.8258 - val_jacard_coef: 0.5850
Epoch 20/60
49/49 [==============================] - 8s 155ms/step - loss: 0.0973 - accuracy: 0.8015 - jacard_coef: 0.5561 - val_loss: 0.0939 - val_accuracy: 0.8121 - val_jacard_coef: 0.5815
Epoch 21/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0956 - accuracy: 0.8073 - jacard_coef: 0.5640 - val_loss: 0.0923 - val_accuracy: 0.8233 - val_jacard_coef: 0.5418
Epoch 22/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0973 - accuracy: 0.8040 - jacard_coef: 0.5566 - val_loss: 0.0892 - val_accuracy: 0.8231 - val_jacard_coef: 0.5936
Epoch 23/60
49/49 [==============================] - 7s 141ms/step - loss: 0.0916 - accuracy: 0.8184 - jacard_coef: 0.5843 - val_loss: 0.0813 - val_accuracy: 0.8433 - val_jacard_coef: 0.6432
Epoch 24/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0887 - accuracy: 0.8223 - jacard_coef: 0.5880 - val_loss: 0.0830 - val_accuracy: 0.8400 - val_jacard_coef: 0.6434
Epoch 25/60
49/49 [==============================] - 8s 155ms/step - loss: 0.0868 - accuracy: 0.8263 - jacard_coef: 0.5978 - val_loss: 0.0782 - val_accuracy: 0.8495 - val_jacard_coef: 0.6444
Epoch 26/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0847 - accuracy: 0.8301 - jacard_coef: 0.6062 - val_loss: 0.0809 - val_accuracy: 0.8418 - val_jacard_coef: 0.6426
Epoch 27/60
49/49 [==============================] - 8s 155ms/step - loss: 0.0853 - accuracy: 0.8289 - jacard_coef: 0.6052 - val_loss: 0.0769 - val_accuracy: 0.8504 - val_jacard_coef: 0.6302
Epoch 28/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0825 - accuracy: 0.8348 - jacard_coef: 0.6133 - val_loss: 0.0757 - val_accuracy: 0.8550 - val_jacard_coef: 0.6313
Epoch 29/60
49/49 [==============================] - 8s 161ms/step - loss: 0.0818 - accuracy: 0.8354 - jacard_coef: 0.6153 - val_loss: 0.0737 - val_accuracy: 0.8580 - val_jacard_coef: 0.6489
Epoch 30/60
49/49 [==============================] - 8s 155ms/step - loss: 0.0818 - accuracy: 0.8357 - jacard_coef: 0.6157 - val_loss: 0.0745 - val_accuracy: 0.8538 - val_jacard_coef: 0.6481
Epoch 31/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0813 - accuracy: 0.8372 - jacard_coef: 0.6185 - val_loss: 0.0777 - val_accuracy: 0.8491 - val_jacard_coef: 0.6303
Epoch 32/60
49/49 [==============================] - 7s 141ms/step - loss: 0.0797 - accuracy: 0.8412 - jacard_coef: 0.6223 - val_loss: 0.0748 - val_accuracy: 0.8522 - val_jacard_coef: 0.6644
Epoch 33/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0790 - accuracy: 0.8416 - jacard_coef: 0.6302 - val_loss: 0.0743 - val_accuracy: 0.8552 - val_jacard_coef: 0.6470
Epoch 34/60
49/49 [==============================] - 8s 156ms/step - loss: 0.0788 - accuracy: 0.8420 - jacard_coef: 0.6237 - val_loss: 0.0766 - val_accuracy: 0.8508 - val_jacard_coef: 0.6315
Epoch 35/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0784 - accuracy: 0.8418 - jacard_coef: 0.6294 - val_loss: 0.0782 - val_accuracy: 0.8487 - val_jacard_coef: 0.6290
Epoch 36/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0789 - accuracy: 0.8412 - jacard_coef: 0.6267 - val_loss: 0.0723 - val_accuracy: 0.8614 - val_jacard_coef: 0.6561
Epoch 37/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0769 - accuracy: 0.8450 - jacard_coef: 0.6322 - val_loss: 0.0753 - val_accuracy: 0.8499 - val_jacard_coef: 0.6538
Epoch 38/60
49/49 [==============================] - 8s 158ms/step - loss: 0.0769 - accuracy: 0.8433 - jacard_coef: 0.6334 - val_loss: 0.0710 - val_accuracy: 0.8614 - val_jacard_coef: 0.6617
Epoch 39/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0752 - accuracy: 0.8469 - jacard_coef: 0.6369 - val_loss: 0.0744 - val_accuracy: 0.8561 - val_jacard_coef: 0.6665
Epoch 40/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0773 - accuracy: 0.8433 - jacard_coef: 0.6299 - val_loss: 0.0704 - val_accuracy: 0.8635 - val_jacard_coef: 0.6781
Epoch 41/60
49/49 [==============================] - 8s 156ms/step - loss: 0.0767 - accuracy: 0.8443 - jacard_coef: 0.6344 - val_loss: 0.0798 - val_accuracy: 0.8456 - val_jacard_coef: 0.6236
Epoch 42/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0784 - accuracy: 0.8416 - jacard_coef: 0.6296 - val_loss: 0.0790 - val_accuracy: 0.8384 - val_jacard_coef: 0.6211
Epoch 43/60
49/49 [==============================] - 8s 158ms/step - loss: 0.0798 - accuracy: 0.8388 - jacard_coef: 0.6225 - val_loss: 0.0722 - val_accuracy: 0.8622 - val_jacard_coef: 0.6380
Epoch 44/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0757 - accuracy: 0.8470 - jacard_coef: 0.6377 - val_loss: 0.0771 - val_accuracy: 0.8493 - val_jacard_coef: 0.6338
Epoch 45/60
49/49 [==============================] - 7s 146ms/step - loss: 0.0769 - accuracy: 0.8446 - jacard_coef: 0.6304 - val_loss: 0.0719 - val_accuracy: 0.8594 - val_jacard_coef: 0.6601
Epoch 46/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0751 - accuracy: 0.8465 - jacard_coef: 0.6390 - val_loss: 0.0790 - val_accuracy: 0.8483 - val_jacard_coef: 0.6421
Epoch 47/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0767 - accuracy: 0.8436 - jacard_coef: 0.6312 - val_loss: 0.0740 - val_accuracy: 0.8554 - val_jacard_coef: 0.6608
Epoch 48/60
49/49 [==============================] - 8s 156ms/step - loss: 0.0758 - accuracy: 0.8453 - jacard_coef: 0.6378 - val_loss: 0.0702 - val_accuracy: 0.8651 - val_jacard_coef: 0.6618
Epoch 49/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0736 - accuracy: 0.8511 - jacard_coef: 0.6426 - val_loss: 0.0703 - val_accuracy: 0.8649 - val_jacard_coef: 0.6559
Epoch 50/60
49/49 [==============================] - 8s 157ms/step - loss: 0.0738 - accuracy: 0.8494 - jacard_coef: 0.6439 - val_loss: 0.0743 - val_accuracy: 0.8564 - val_jacard_coef: 0.6691
Epoch 51/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0758 - accuracy: 0.8460 - jacard_coef: 0.6352 - val_loss: 0.0703 - val_accuracy: 0.8638 - val_jacard_coef: 0.6718
Epoch 52/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0716 - accuracy: 0.8530 - jacard_coef: 0.6504 - val_loss: 0.0700 - val_accuracy: 0.8657 - val_jacard_coef: 0.6825
Epoch 53/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0711 - accuracy: 0.8538 - jacard_coef: 0.6522 - val_loss: 0.0704 - val_accuracy: 0.8646 - val_jacard_coef: 0.6873
Epoch 54/60
49/49 [==============================] - 8s 158ms/step - loss: 0.0704 - accuracy: 0.8548 - jacard_coef: 0.6549 - val_loss: 0.0681 - val_accuracy: 0.8681 - val_jacard_coef: 0.6739
Epoch 55/60
49/49 [==============================] - 7s 144ms/step - loss: 0.0716 - accuracy: 0.8532 - jacard_coef: 0.6508 - val_loss: 0.0694 - val_accuracy: 0.8665 - val_jacard_coef: 0.6495
Epoch 56/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0719 - accuracy: 0.8529 - jacard_coef: 0.6485 - val_loss: 0.0684 - val_accuracy: 0.8666 - val_jacard_coef: 0.6671
Epoch 57/60
49/49 [==============================] - 7s 146ms/step - loss: 0.0699 - accuracy: 0.8559 - jacard_coef: 0.6558 - val_loss: 0.0683 - val_accuracy: 0.8663 - val_jacard_coef: 0.6855
Epoch 58/60
49/49 [==============================] - 8s 156ms/step - loss: 0.0705 - accuracy: 0.8559 - jacard_coef: 0.6551 - val_loss: 0.0681 - val_accuracy: 0.8653 - val_jacard_coef: 0.6788
Epoch 59/60
49/49 [==============================] - 7s 145ms/step - loss: 0.0700 - accuracy: 0.8554 - jacard_coef: 0.6548 - val_loss: 0.0704 - val_accuracy: 0.8595 - val_jacard_coef: 0.6798
Epoch 60/60
49/49 [==============================] - 7s 142ms/step - loss: 0.0704 - accuracy: 0.8555 - jacard_coef: 0.6548 - val_loss: 0.0724 - val_accuracy: 0.8639 - val_jacard_coef: 0.6920
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="s1">&#39;/models/small_unet1.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-training-and-validation-accuracy-and-loss-at-each-epoch">
<h2>Plot the training and validation accuracy and loss at each epoch<a class="headerlink" href="#plot-the-training-and-validation-accuracy-and-loss-at-each-epoch" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">history1</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span>
<span class="n">val_loss</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">]</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and validation loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">acc</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;jacard_coef&#39;</span><span class="p">]</span>
<span class="n">val_acc</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_jacard_coef&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training IoU&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_acc</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation IoU&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and validation IoU&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;IoU&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2a9d5334c807fe4aaa590bff8a30e953bf314d338ce7f641c707872b1a8583a5.png" src="../../../_images/2a9d5334c807fe4aaa590bff8a30e953bf314d338ce7f641c707872b1a8583a5.png" />
<img alt="../../../_images/2ce2565201fbfeefc5ec49f25838dd9ebb79f10db6d224891ffe64d06d8c53b6.png" src="../../../_images/2ce2565201fbfeefc5ec49f25838dd9ebb79f10db6d224891ffe64d06d8c53b6.png" />
</div>
</div>
</section>
<section id="visualize-predictions">
<h2>Visualize predictions<a class="headerlink" href="#visualize-predictions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">reload</span>
<span class="c1"># test_img_number = random.randint(0, len(X_test))</span>
<span class="n">test_img_number</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">test_img</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">test_img_number</span><span class="p">]</span>
<span class="n">ground_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)[</span><span class="n">test_img_number</span><span class="p">]</span>
<span class="c1">#test_img_norm=test_img[:,:,0][:,:,None]</span>
<span class="n">test_img_input</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">test_img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_img_input</span><span class="p">))</span>
<span class="n">predicted_img</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:,:]</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span> 
<span class="c1"># label == Building : 0</span>
<span class="c1"># label==Land : 1</span>
<span class="c1"># label==Road : 2</span>
<span class="c1"># label==Vegetation : 3</span>
<span class="c1"># label==Water : 4</span>
<span class="c1"># label==Unlabeled : 5</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">]</span> 
<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">231</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Testing Image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">test_img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">232</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Testing Label&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">233</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prediction on test image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">predicted_img</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 1s 547ms/step
</pre></div>
</div>
<img alt="../../../_images/dd043e3e6d07540d6fc79aed39a3235ace62242f873ea5b04d02cf979362107c.png" src="../../../_images/dd043e3e6d07540d6fc79aed39a3235ace62242f873ea5b04d02cf979362107c.png" />
</div>
</div>
</section>
<section id="exercises-1-finetune-the-segmentation-model">
<h2>Exercises 1. Finetune the segmentation model<a class="headerlink" href="#exercises-1-finetune-the-segmentation-model" title="Link to this heading">#</a></h2>
<p>Now try adjusting the model by implementing different methods of reducing overfitting and increasing the model’s ability to generalise.</p>
<ol class="arabic simple">
<li><p>Retrain the model by using or adding a different loss function and see what happens to the performance of the segmentation model. The segmentation models losses can be combined together by ‘+’ and scaled by integer or float factor set class weights for dice_loss.
E.g., add in a <strong>categorical_crossentropy</strong> or <strong>CategoricalFocalLoss</strong> loss in the Configure the model for training section.</p></li>
</ol>
<blockquote>
<div><p>Hint: Further details for loss options can be found in <a class="reference external" href="https://segmentation-models.readthedocs.io/en/latest/api.html?highlight=loss#losses">segmentation losses</a></p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1666</span><span class="p">,</span> <span class="mf">0.1666</span><span class="p">,</span> <span class="mf">0.1666</span><span class="p">,</span> <span class="mf">0.1666</span><span class="p">,</span> <span class="mf">0.1666</span><span class="p">,</span> <span class="mf">0.1666</span><span class="p">]</span>
<span class="n">dice_loss</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">DiceLoss</span><span class="p">(</span><span class="n">class_weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span> 
<span class="n">focal_loss</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">CategoricalFocalLoss</span><span class="p">()</span>
<span class="n">total_loss</span> <span class="o">=</span> <span class="n">dice_loss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">focal_loss</span><span class="p">)</span>  <span class="c1">#</span>

<span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">jacard_coef</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">CategoricalCELoss</span><span class="p">(),</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>In the previous model, the contracting path follows the formula:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">conv_layer1</span> <span class="pre">-&gt;</span> <span class="pre">conv_layer2</span> <span class="pre">-&gt;</span> <span class="pre">max_pooling</span></code></p>
<p>In the expansive path, the image is going to be upsized to its original size. The formula follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">conv_2d_transpose</span> <span class="pre">-&gt;</span> <span class="pre">concatenate</span> <span class="pre">-&gt;</span> <span class="pre">conv_layer1</span> <span class="pre">-&gt;</span> <span class="pre">conv_layer2</span></code></p>
<p>We built 2 contracting blocks and 2 expansive blocks. Can you repeat the bock more times? Does this improve the segmentation results?</p>
<blockquote>
<div><p>Hint: Make sure the start and end image dimensions match, check the UNET structure in you’ve created small_unet1.png</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  unet - 5 layers</span>

<span class="n">num_classes</span><span class="o">=</span><span class="mi">6</span>
<span class="n">IMG_HEIGHT</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_WIDTH</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_CHANNELS</span><span class="o">=</span><span class="mi">3</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">((</span><span class="n">IMG_HEIGHT</span><span class="p">,</span> <span class="n">IMG_WIDTH</span><span class="p">,</span> <span class="n">IMG_CHANNELS</span><span class="p">))</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c1</span><span class="p">)</span>

<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c2</span><span class="p">)</span>
  
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c3</span><span class="p">)</span>

<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p3</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c4</span><span class="p">)</span>

<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p4</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>

<span class="n">c6</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c5</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c6</span><span class="p">,</span> <span class="n">c4</span><span class="p">])</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c6</span><span class="p">)</span>

<span class="n">c7</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c7</span><span class="p">,</span> <span class="n">c3</span><span class="p">])</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c7</span><span class="p">)</span>


<span class="n">c8</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c8</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c8</span><span class="p">)</span>
  
<span class="n">c9</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c9</span><span class="p">,</span> <span class="n">c1</span><span class="p">])</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

<span class="c1"># model.summary()</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Change the CONV layers with Batch Normalization &amp; Dropout.</p></li>
</ol>
<ul class="simple">
<li><p>One common issue in training a Segmentation model based on Deep Convolutional Neural Network for is <strong>the internal covariate shift</strong>, where the training of convolutional kernels is encumbered by the distribution change of input features, hence both the training speed and performance are decreased. Batch Normalization is the first proposed method for addressing internal
covariate shift and is widely used.</p></li>
<li><p>Since <strong>parameter size</strong> in some Conv layers are quite large, and the training data is small. It is reasonable to add dropout between larg convolutional connections.</p></li>
</ul>
<blockquote>
<div><p>Hint:</p>
</div></blockquote>
<ul class="simple">
<li><p>Keras Implementation of <a class="reference external" href="https://keras.io/api/layers/normalization_layers/batch_normalization/">Batch normalisation</a></p></li>
<li><p>Keras Implementation of <a class="reference external" href="https://keras.io/api/layers/regularization_layers/dropout/">Dropout</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  unet - 5 blocks with dropout and BN</span>

<span class="n">num_classes</span><span class="o">=</span><span class="mi">6</span>
<span class="n">IMG_HEIGHT</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_WIDTH</span><span class="o">=</span><span class="mi">256</span>
<span class="n">IMG_CHANNELS</span><span class="o">=</span><span class="mi">3</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">((</span><span class="n">IMG_HEIGHT</span><span class="p">,</span> <span class="n">IMG_WIDTH</span><span class="p">,</span> <span class="n">IMG_CHANNELS</span><span class="p">))</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c1</span><span class="p">)</span>

<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c2</span><span class="p">)</span>
  
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c3</span><span class="p">)</span>

<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p3</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c4</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">()(</span><span class="n">c4</span><span class="p">)</span>

<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">p4</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c5</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c5</span><span class="p">)</span>

<span class="n">c6</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c5</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c6</span><span class="p">,</span> <span class="n">c4</span><span class="p">])</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c6</span><span class="p">)</span>

<span class="n">c7</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c6</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c7</span><span class="p">,</span> <span class="n">c3</span><span class="p">])</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c7</span><span class="p">)</span>


<span class="n">c8</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c7</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c8</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c8</span><span class="p">)</span>
  
<span class="n">c9</span> <span class="o">=</span> <span class="n">UpSampling2D</span><span class="p">()(</span><span class="n">c8</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">c9</span><span class="p">,</span> <span class="n">c1</span><span class="p">])</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">c9</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">c9</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>

<span class="c1"># model.summary()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">DiceLoss</span><span class="p">(),</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
<span class="c1"># model.summary()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> 
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> 
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">),</span> 
                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/60
49/49 [==============================] - 27s 323ms/step - loss: 0.5797 - accuracy: 0.6922 - jacard_coef: 0.4777 - val_loss: 0.8807 - val_accuracy: 0.2187 - val_jacard_coef: 0.1328
Epoch 2/60
49/49 [==============================] - 12s 241ms/step - loss: 0.4750 - accuracy: 0.7434 - jacard_coef: 0.5834 - val_loss: 0.6771 - val_accuracy: 0.4310 - val_jacard_coef: 0.2817
Epoch 3/60
49/49 [==============================] - 11s 232ms/step - loss: 0.4366 - accuracy: 0.7680 - jacard_coef: 0.6205 - val_loss: 0.5331 - val_accuracy: 0.7195 - val_jacard_coef: 0.5457
Epoch 4/60
49/49 [==============================] - 12s 241ms/step - loss: 0.4200 - accuracy: 0.7773 - jacard_coef: 0.6351 - val_loss: 0.5595 - val_accuracy: 0.7741 - val_jacard_coef: 0.6346
Epoch 5/60
49/49 [==============================] - 12s 242ms/step - loss: 0.4092 - accuracy: 0.7893 - jacard_coef: 0.6511 - val_loss: 0.4738 - val_accuracy: 0.7973 - val_jacard_coef: 0.6688
Epoch 6/60
49/49 [==============================] - 12s 243ms/step - loss: 0.4040 - accuracy: 0.7929 - jacard_coef: 0.6566 - val_loss: 0.4463 - val_accuracy: 0.8252 - val_jacard_coef: 0.7060
Epoch 7/60
49/49 [==============================] - 11s 234ms/step - loss: 0.4038 - accuracy: 0.7913 - jacard_coef: 0.6550 - val_loss: 0.4346 - val_accuracy: 0.8193 - val_jacard_coef: 0.6979
Epoch 8/60
49/49 [==============================] - 12s 244ms/step - loss: 0.3949 - accuracy: 0.8019 - jacard_coef: 0.6697 - val_loss: 0.4744 - val_accuracy: 0.7818 - val_jacard_coef: 0.6480
Epoch 9/60
49/49 [==============================] - 12s 235ms/step - loss: 0.4054 - accuracy: 0.7905 - jacard_coef: 0.6536 - val_loss: 0.4259 - val_accuracy: 0.8335 - val_jacard_coef: 0.7173
Epoch 10/60
49/49 [==============================] - 12s 236ms/step - loss: 0.3951 - accuracy: 0.7976 - jacard_coef: 0.6616 - val_loss: 0.5435 - val_accuracy: 0.7123 - val_jacard_coef: 0.5709
Epoch 11/60
49/49 [==============================] - 12s 247ms/step - loss: 0.3889 - accuracy: 0.7964 - jacard_coef: 0.6617 - val_loss: 0.4315 - val_accuracy: 0.8161 - val_jacard_coef: 0.6934
Epoch 12/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3794 - accuracy: 0.7962 - jacard_coef: 0.6628 - val_loss: 0.4233 - val_accuracy: 0.8286 - val_jacard_coef: 0.7118
Epoch 13/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3802 - accuracy: 0.7973 - jacard_coef: 0.6636 - val_loss: 0.4104 - val_accuracy: 0.8331 - val_jacard_coef: 0.7174
Epoch 14/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3734 - accuracy: 0.8038 - jacard_coef: 0.6722 - val_loss: 0.5523 - val_accuracy: 0.5667 - val_jacard_coef: 0.3986
Epoch 15/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3754 - accuracy: 0.8025 - jacard_coef: 0.6707 - val_loss: 0.4044 - val_accuracy: 0.8453 - val_jacard_coef: 0.7364
Epoch 16/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3701 - accuracy: 0.8058 - jacard_coef: 0.6762 - val_loss: 0.4532 - val_accuracy: 0.8120 - val_jacard_coef: 0.6867
Epoch 17/60
49/49 [==============================] - 12s 249ms/step - loss: 0.3667 - accuracy: 0.8124 - jacard_coef: 0.6858 - val_loss: 0.4320 - val_accuracy: 0.8239 - val_jacard_coef: 0.7069
Epoch 18/60
49/49 [==============================] - 12s 238ms/step - loss: 0.3791 - accuracy: 0.7990 - jacard_coef: 0.6678 - val_loss: 0.4382 - val_accuracy: 0.8080 - val_jacard_coef: 0.6858
Epoch 19/60
49/49 [==============================] - 12s 239ms/step - loss: 0.3703 - accuracy: 0.8091 - jacard_coef: 0.6807 - val_loss: 0.4722 - val_accuracy: 0.8017 - val_jacard_coef: 0.6726
Epoch 20/60
49/49 [==============================] - 12s 240ms/step - loss: 0.3719 - accuracy: 0.8063 - jacard_coef: 0.6774 - val_loss: 0.4498 - val_accuracy: 0.8171 - val_jacard_coef: 0.6957
Epoch 21/60
49/49 [==============================] - 12s 250ms/step - loss: 0.3493 - accuracy: 0.8206 - jacard_coef: 0.6965 - val_loss: 0.4212 - val_accuracy: 0.8218 - val_jacard_coef: 0.7015
Epoch 22/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3522 - accuracy: 0.8220 - jacard_coef: 0.6989 - val_loss: 0.4126 - val_accuracy: 0.8263 - val_jacard_coef: 0.7119
Epoch 23/60
49/49 [==============================] - 12s 241ms/step - loss: 0.3534 - accuracy: 0.8203 - jacard_coef: 0.6966 - val_loss: 0.4133 - val_accuracy: 0.8260 - val_jacard_coef: 0.7072
Epoch 24/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3582 - accuracy: 0.8167 - jacard_coef: 0.6912 - val_loss: 0.4695 - val_accuracy: 0.8002 - val_jacard_coef: 0.6710
Epoch 25/60
49/49 [==============================] - 12s 250ms/step - loss: 0.3640 - accuracy: 0.8168 - jacard_coef: 0.6923 - val_loss: 0.4291 - val_accuracy: 0.8210 - val_jacard_coef: 0.6994
Epoch 26/60
49/49 [==============================] - 12s 241ms/step - loss: 0.3490 - accuracy: 0.8204 - jacard_coef: 0.6962 - val_loss: 0.5927 - val_accuracy: 0.6379 - val_jacard_coef: 0.4722
Epoch 27/60
49/49 [==============================] - 12s 240ms/step - loss: 0.3554 - accuracy: 0.8224 - jacard_coef: 0.6991 - val_loss: 0.4136 - val_accuracy: 0.8347 - val_jacard_coef: 0.7191
Epoch 28/60
49/49 [==============================] - 12s 250ms/step - loss: 0.3433 - accuracy: 0.8272 - jacard_coef: 0.7064 - val_loss: 0.4055 - val_accuracy: 0.8376 - val_jacard_coef: 0.7234
Epoch 29/60
49/49 [==============================] - 12s 240ms/step - loss: 0.3447 - accuracy: 0.8260 - jacard_coef: 0.7050 - val_loss: 0.4224 - val_accuracy: 0.8339 - val_jacard_coef: 0.7175
Epoch 30/60
49/49 [==============================] - 12s 240ms/step - loss: 0.3329 - accuracy: 0.8338 - jacard_coef: 0.7159 - val_loss: 0.3907 - val_accuracy: 0.8504 - val_jacard_coef: 0.7419
Epoch 31/60
49/49 [==============================] - 12s 242ms/step - loss: 0.3365 - accuracy: 0.8320 - jacard_coef: 0.7131 - val_loss: 0.4175 - val_accuracy: 0.8354 - val_jacard_coef: 0.7194
Epoch 32/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3410 - accuracy: 0.8289 - jacard_coef: 0.7085 - val_loss: 0.4173 - val_accuracy: 0.8295 - val_jacard_coef: 0.7136
Epoch 33/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3453 - accuracy: 0.8290 - jacard_coef: 0.7092 - val_loss: 0.4085 - val_accuracy: 0.8297 - val_jacard_coef: 0.7115
Epoch 34/60
49/49 [==============================] - 12s 242ms/step - loss: 0.3310 - accuracy: 0.8342 - jacard_coef: 0.7162 - val_loss: 0.3795 - val_accuracy: 0.8563 - val_jacard_coef: 0.7519
Epoch 35/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3366 - accuracy: 0.8319 - jacard_coef: 0.7133 - val_loss: 0.4072 - val_accuracy: 0.8416 - val_jacard_coef: 0.7289
Epoch 36/60
49/49 [==============================] - 12s 242ms/step - loss: 0.3377 - accuracy: 0.8324 - jacard_coef: 0.7144 - val_loss: 0.3822 - val_accuracy: 0.8536 - val_jacard_coef: 0.7473
Epoch 37/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3359 - accuracy: 0.8337 - jacard_coef: 0.7157 - val_loss: 0.4385 - val_accuracy: 0.8260 - val_jacard_coef: 0.7066
Epoch 38/60
49/49 [==============================] - 12s 253ms/step - loss: 0.3304 - accuracy: 0.8348 - jacard_coef: 0.7175 - val_loss: 0.3771 - val_accuracy: 0.8525 - val_jacard_coef: 0.7459
Epoch 39/60
49/49 [==============================] - 12s 243ms/step - loss: 0.3323 - accuracy: 0.8349 - jacard_coef: 0.7173 - val_loss: 0.4199 - val_accuracy: 0.8166 - val_jacard_coef: 0.6985
Epoch 40/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3415 - accuracy: 0.8299 - jacard_coef: 0.7108 - val_loss: 0.4187 - val_accuracy: 0.8150 - val_jacard_coef: 0.6958
Epoch 41/60
49/49 [==============================] - 12s 243ms/step - loss: 0.3356 - accuracy: 0.8339 - jacard_coef: 0.7162 - val_loss: 0.4141 - val_accuracy: 0.8387 - val_jacard_coef: 0.7262
Epoch 42/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3352 - accuracy: 0.8372 - jacard_coef: 0.7210 - val_loss: 0.4330 - val_accuracy: 0.8331 - val_jacard_coef: 0.7184
Epoch 43/60
49/49 [==============================] - 12s 244ms/step - loss: 0.3312 - accuracy: 0.8344 - jacard_coef: 0.7170 - val_loss: 0.4253 - val_accuracy: 0.8288 - val_jacard_coef: 0.7088
Epoch 44/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3231 - accuracy: 0.8389 - jacard_coef: 0.7237 - val_loss: 0.3825 - val_accuracy: 0.8573 - val_jacard_coef: 0.7529
Epoch 45/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3246 - accuracy: 0.8395 - jacard_coef: 0.7242 - val_loss: 0.4247 - val_accuracy: 0.8275 - val_jacard_coef: 0.7090
Epoch 46/60
49/49 [==============================] - 12s 243ms/step - loss: 0.3392 - accuracy: 0.8320 - jacard_coef: 0.7132 - val_loss: 0.4224 - val_accuracy: 0.8193 - val_jacard_coef: 0.6988
Epoch 47/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3262 - accuracy: 0.8376 - jacard_coef: 0.7219 - val_loss: 0.3898 - val_accuracy: 0.8559 - val_jacard_coef: 0.7510
Epoch 48/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3248 - accuracy: 0.8380 - jacard_coef: 0.7226 - val_loss: 0.4893 - val_accuracy: 0.7761 - val_jacard_coef: 0.6405
Epoch 49/60
49/49 [==============================] - 12s 243ms/step - loss: 0.3446 - accuracy: 0.8270 - jacard_coef: 0.7064 - val_loss: 0.6749 - val_accuracy: 0.5197 - val_jacard_coef: 0.3583
Epoch 50/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3325 - accuracy: 0.8367 - jacard_coef: 0.7201 - val_loss: 0.5264 - val_accuracy: 0.7397 - val_jacard_coef: 0.5893
Epoch 51/60
49/49 [==============================] - 12s 241ms/step - loss: 0.3505 - accuracy: 0.8249 - jacard_coef: 0.7031 - val_loss: 0.6092 - val_accuracy: 0.6052 - val_jacard_coef: 0.4385
Epoch 52/60
49/49 [==============================] - 12s 242ms/step - loss: 0.3372 - accuracy: 0.8317 - jacard_coef: 0.7131 - val_loss: 0.4138 - val_accuracy: 0.8022 - val_jacard_coef: 0.6760
Epoch 53/60
49/49 [==============================] - 12s 253ms/step - loss: 0.3283 - accuracy: 0.8388 - jacard_coef: 0.7232 - val_loss: 0.4062 - val_accuracy: 0.8408 - val_jacard_coef: 0.7272
Epoch 54/60
49/49 [==============================] - 12s 242ms/step - loss: 0.3285 - accuracy: 0.8383 - jacard_coef: 0.7224 - val_loss: 0.3761 - val_accuracy: 0.8609 - val_jacard_coef: 0.7585
Epoch 55/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3228 - accuracy: 0.8410 - jacard_coef: 0.7265 - val_loss: 0.4029 - val_accuracy: 0.8402 - val_jacard_coef: 0.7284
Epoch 56/60
49/49 [==============================] - 12s 244ms/step - loss: 0.3359 - accuracy: 0.8337 - jacard_coef: 0.7156 - val_loss: 0.4054 - val_accuracy: 0.8328 - val_jacard_coef: 0.7152
Epoch 57/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3283 - accuracy: 0.8395 - jacard_coef: 0.7247 - val_loss: 0.3997 - val_accuracy: 0.8478 - val_jacard_coef: 0.7391
Epoch 58/60
49/49 [==============================] - 12s 251ms/step - loss: 0.3257 - accuracy: 0.8419 - jacard_coef: 0.7281 - val_loss: 0.4117 - val_accuracy: 0.8313 - val_jacard_coef: 0.7160
Epoch 59/60
49/49 [==============================] - 12s 244ms/step - loss: 0.3206 - accuracy: 0.8440 - jacard_coef: 0.7311 - val_loss: 0.3676 - val_accuracy: 0.8651 - val_jacard_coef: 0.7649
Epoch 60/60
49/49 [==============================] - 12s 252ms/step - loss: 0.3153 - accuracy: 0.8449 - jacard_coef: 0.7326 - val_loss: 0.3888 - val_accuracy: 0.8583 - val_jacard_coef: 0.7526
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">reload</span>
<span class="c1"># test_img_number = random.randint(0, len(X_test))</span>
<span class="n">test_img_number</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">test_img</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">test_img_number</span><span class="p">]</span>
<span class="n">ground_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)[</span><span class="n">test_img_number</span><span class="p">]</span>
<span class="c1">#test_img_norm=test_img[:,:,0][:,:,None]</span>
<span class="n">test_img_input</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">test_img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_img_input</span><span class="p">))</span>
<span class="n">predicted_img</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:,:]</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span> 
<span class="c1"># label == Building : 0</span>
<span class="c1"># label==Land : 1</span>
<span class="c1"># label==Road : 2</span>
<span class="c1"># label==Vegetation : 3</span>
<span class="c1"># label==Water : 4</span>
<span class="c1"># label==Unlabeled : 5</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">]</span> 
<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">231</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Testing Image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">test_img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">232</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Testing Label&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">233</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prediction on test image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">predicted_img</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 0s 319ms/step
</pre></div>
</div>
<img alt="../../../_images/cc0ceccf179172e114eefdc9ade377bd6f2cf7f018cde01257b2387aea92ecce.png" src="../../../_images/cc0ceccf179172e114eefdc9ade377bd6f2cf7f018cde01257b2387aea92ecce.png" />
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Data augmentation of your choice.</p></li>
</ol>
<blockquote>
<div><p>Hint: <strong>scipy.ndimage</strong> module provides a powerful set of general, n-dimensional image processing operations. <a class="reference external" href="https://docs.scipy.org/doc/scipy-0.14.0/reference/ndimage.html#module-scipy.ndimage.interpolation">Interpolation in scipy.ndimage</a> include basic operations like shifts, rotations and resizing as well as more general coordinate transformations like affine transforms or warping. See the following rotate example:</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage.interpolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">rotate</span>

<span class="n">X_tmp</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># rotate</span>
<span class="n">X_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_tmp</span><span class="p">,</span> <span class="n">rotate</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_tmp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">Y_tmp</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Y_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_tmp</span><span class="p">,</span> <span class="n">rotate</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">Y_tmp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;###after data augmentation###&quot;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">del</span> <span class="n">X_tmp</span><span class="p">,</span> <span class="n">Y_tmp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-11-f2cbbbbb90b1&gt;:1: DeprecationWarning: Please use `rotate` from the `scipy.ndimage` namespace, the `scipy.ndimage.interpolation` namespace is deprecated.
  from scipy.ndimage.interpolation import rotate
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>###after data augmentation### (2349, 256, 256, 3) (2349, 256, 256, 6)
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises-2-try-another-model">
<h2>Exercises 2.Try another model<a class="headerlink" href="#exercises-2-try-another-model" title="Link to this heading">#</a></h2>
<p>Change the network architecture to U-net with Resnet backbone. Use pretrainded weights to initialize it.</p>
<blockquote>
<div><p>Hint: To do this, follow the instructions in <a class="reference external" href="https://segmentation-models.readthedocs.io/en/latest/tutorial.html?highlight=loss#simple-training-pipeline">Segmentation Models Python API</a>, and you can implete U-net with pretrained weights in simple two lines. It provides 4 models architectures for binary and multi class segmentation (including legendary Unet) and 25 available backbones for each architecture.  All backbones have pre-trained weights for faster and better convergence.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BACKBONE</span> <span class="o">=</span> <span class="s1">&#39;resnet34&#39;</span>
<span class="n">preprocess_input</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">get_preprocessing</span><span class="p">(</span><span class="n">BACKBONE</span><span class="p">)</span>

<span class="c1"># preprocess input</span>
<span class="n">X_train_prepr</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_prepr</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_framework</span><span class="p">(</span><span class="s1">&#39;tf.keras&#39;</span><span class="p">)</span>

<span class="n">sm</span><span class="o">.</span><span class="n">framework</span><span class="p">()</span>
<span class="c1"># define model</span>
<span class="n">model_resnet_backbone</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Unet</span><span class="p">(</span><span class="n">BACKBONE</span><span class="p">,</span> <span class="n">encoder_weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>

<span class="c1"># compile keras model with defined optimozer, loss and metrics</span>
<span class="c1">#model_resnet_backbone.compile(optimizer=&#39;adam&#39;, loss=focal_loss, metrics=metrics)</span>
<span class="n">model_resnet_backbone</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_resnet_backbone</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>


<span class="n">history3</span><span class="o">=</span><span class="n">model_resnet_backbone</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_prepr</span><span class="p">,</span> 
          <span class="n">y_train</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> 
          <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test_prepr</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading data from https://github.com/qubvel/classification_models/releases/download/0.0.1/resnet34_imagenet_1000_no_top.h5
85521592/85521592 [==============================] - 1s 0us/step
Model: &quot;model_4&quot;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 data (InputLayer)              [(None, None, None,  0           []                               
                                 3)]                                                              
                                                                                                  
 bn_data (BatchNormalization)   (None, None, None,   9           [&#39;data[0][0]&#39;]                   
                                3)                                                                
                                                                                                  
 zero_padding2d (ZeroPadding2D)  (None, None, None,   0          [&#39;bn_data[0][0]&#39;]                
                                3)                                                                
                                                                                                  
 conv0 (Conv2D)                 (None, None, None,   9408        [&#39;zero_padding2d[0][0]&#39;]         
                                64)                                                               
                                                                                                  
 bn0 (BatchNormalization)       (None, None, None,   256         [&#39;conv0[0][0]&#39;]                  
                                64)                                                               
                                                                                                  
 relu0 (Activation)             (None, None, None,   0           [&#39;bn0[0][0]&#39;]                    
                                64)                                                               
                                                                                                  
 zero_padding2d_1 (ZeroPadding2  (None, None, None,   0          [&#39;relu0[0][0]&#39;]                  
 D)                             64)                                                               
                                                                                                  
 pooling0 (MaxPooling2D)        (None, None, None,   0           [&#39;zero_padding2d_1[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 stage1_unit1_bn1 (BatchNormali  (None, None, None,   256        [&#39;pooling0[0][0]&#39;]               
 zation)                        64)                                                               
                                                                                                  
 stage1_unit1_relu1 (Activation  (None, None, None,   0          [&#39;stage1_unit1_bn1[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_2 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit1_relu1[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit1_conv1 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_2[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 stage1_unit1_bn2 (BatchNormali  (None, None, None,   256        [&#39;stage1_unit1_conv1[0][0]&#39;]     
 zation)                        64)                                                               
                                                                                                  
 stage1_unit1_relu2 (Activation  (None, None, None,   0          [&#39;stage1_unit1_bn2[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_3 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit1_relu2[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit1_conv2 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_3[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 stage1_unit1_sc (Conv2D)       (None, None, None,   4096        [&#39;stage1_unit1_relu1[0][0]&#39;]     
                                64)                                                               
                                                                                                  
 add (Add)                      (None, None, None,   0           [&#39;stage1_unit1_conv2[0][0]&#39;,     
                                64)                               &#39;stage1_unit1_sc[0][0]&#39;]        
                                                                                                  
 stage1_unit2_bn1 (BatchNormali  (None, None, None,   256        [&#39;add[0][0]&#39;]                    
 zation)                        64)                                                               
                                                                                                  
 stage1_unit2_relu1 (Activation  (None, None, None,   0          [&#39;stage1_unit2_bn1[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_4 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit2_relu1[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit2_conv1 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_4[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 stage1_unit2_bn2 (BatchNormali  (None, None, None,   256        [&#39;stage1_unit2_conv1[0][0]&#39;]     
 zation)                        64)                                                               
                                                                                                  
 stage1_unit2_relu2 (Activation  (None, None, None,   0          [&#39;stage1_unit2_bn2[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_5 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit2_relu2[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit2_conv2 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_5[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 add_1 (Add)                    (None, None, None,   0           [&#39;stage1_unit2_conv2[0][0]&#39;,     
                                64)                               &#39;add[0][0]&#39;]                    
                                                                                                  
 stage1_unit3_bn1 (BatchNormali  (None, None, None,   256        [&#39;add_1[0][0]&#39;]                  
 zation)                        64)                                                               
                                                                                                  
 stage1_unit3_relu1 (Activation  (None, None, None,   0          [&#39;stage1_unit3_bn1[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_6 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit3_relu1[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit3_conv1 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_6[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 stage1_unit3_bn2 (BatchNormali  (None, None, None,   256        [&#39;stage1_unit3_conv1[0][0]&#39;]     
 zation)                        64)                                                               
                                                                                                  
 stage1_unit3_relu2 (Activation  (None, None, None,   0          [&#39;stage1_unit3_bn2[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_7 (ZeroPadding2  (None, None, None,   0          [&#39;stage1_unit3_relu2[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage1_unit3_conv2 (Conv2D)    (None, None, None,   36864       [&#39;zero_padding2d_7[0][0]&#39;]       
                                64)                                                               
                                                                                                  
 add_2 (Add)                    (None, None, None,   0           [&#39;stage1_unit3_conv2[0][0]&#39;,     
                                64)                               &#39;add_1[0][0]&#39;]                  
                                                                                                  
 stage2_unit1_bn1 (BatchNormali  (None, None, None,   256        [&#39;add_2[0][0]&#39;]                  
 zation)                        64)                                                               
                                                                                                  
 stage2_unit1_relu1 (Activation  (None, None, None,   0          [&#39;stage2_unit1_bn1[0][0]&#39;]       
 )                              64)                                                               
                                                                                                  
 zero_padding2d_8 (ZeroPadding2  (None, None, None,   0          [&#39;stage2_unit1_relu1[0][0]&#39;]     
 D)                             64)                                                               
                                                                                                  
 stage2_unit1_conv1 (Conv2D)    (None, None, None,   73728       [&#39;zero_padding2d_8[0][0]&#39;]       
                                128)                                                              
                                                                                                  
 stage2_unit1_bn2 (BatchNormali  (None, None, None,   512        [&#39;stage2_unit1_conv1[0][0]&#39;]     
 zation)                        128)                                                              
                                                                                                  
 stage2_unit1_relu2 (Activation  (None, None, None,   0          [&#39;stage2_unit1_bn2[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_9 (ZeroPadding2  (None, None, None,   0          [&#39;stage2_unit1_relu2[0][0]&#39;]     
 D)                             128)                                                              
                                                                                                  
 stage2_unit1_conv2 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_9[0][0]&#39;]       
                                128)                                                              
                                                                                                  
 stage2_unit1_sc (Conv2D)       (None, None, None,   8192        [&#39;stage2_unit1_relu1[0][0]&#39;]     
                                128)                                                              
                                                                                                  
 add_3 (Add)                    (None, None, None,   0           [&#39;stage2_unit1_conv2[0][0]&#39;,     
                                128)                              &#39;stage2_unit1_sc[0][0]&#39;]        
                                                                                                  
 stage2_unit2_bn1 (BatchNormali  (None, None, None,   512        [&#39;add_3[0][0]&#39;]                  
 zation)                        128)                                                              
                                                                                                  
 stage2_unit2_relu1 (Activation  (None, None, None,   0          [&#39;stage2_unit2_bn1[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_10 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit2_relu1[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit2_conv1 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_10[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 stage2_unit2_bn2 (BatchNormali  (None, None, None,   512        [&#39;stage2_unit2_conv1[0][0]&#39;]     
 zation)                        128)                                                              
                                                                                                  
 stage2_unit2_relu2 (Activation  (None, None, None,   0          [&#39;stage2_unit2_bn2[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_11 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit2_relu2[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit2_conv2 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_11[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 add_4 (Add)                    (None, None, None,   0           [&#39;stage2_unit2_conv2[0][0]&#39;,     
                                128)                              &#39;add_3[0][0]&#39;]                  
                                                                                                  
 stage2_unit3_bn1 (BatchNormali  (None, None, None,   512        [&#39;add_4[0][0]&#39;]                  
 zation)                        128)                                                              
                                                                                                  
 stage2_unit3_relu1 (Activation  (None, None, None,   0          [&#39;stage2_unit3_bn1[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_12 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit3_relu1[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit3_conv1 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_12[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 stage2_unit3_bn2 (BatchNormali  (None, None, None,   512        [&#39;stage2_unit3_conv1[0][0]&#39;]     
 zation)                        128)                                                              
                                                                                                  
 stage2_unit3_relu2 (Activation  (None, None, None,   0          [&#39;stage2_unit3_bn2[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_13 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit3_relu2[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit3_conv2 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_13[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 add_5 (Add)                    (None, None, None,   0           [&#39;stage2_unit3_conv2[0][0]&#39;,     
                                128)                              &#39;add_4[0][0]&#39;]                  
                                                                                                  
 stage2_unit4_bn1 (BatchNormali  (None, None, None,   512        [&#39;add_5[0][0]&#39;]                  
 zation)                        128)                                                              
                                                                                                  
 stage2_unit4_relu1 (Activation  (None, None, None,   0          [&#39;stage2_unit4_bn1[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_14 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit4_relu1[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit4_conv1 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_14[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 stage2_unit4_bn2 (BatchNormali  (None, None, None,   512        [&#39;stage2_unit4_conv1[0][0]&#39;]     
 zation)                        128)                                                              
                                                                                                  
 stage2_unit4_relu2 (Activation  (None, None, None,   0          [&#39;stage2_unit4_bn2[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_15 (ZeroPadding  (None, None, None,   0          [&#39;stage2_unit4_relu2[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage2_unit4_conv2 (Conv2D)    (None, None, None,   147456      [&#39;zero_padding2d_15[0][0]&#39;]      
                                128)                                                              
                                                                                                  
 add_6 (Add)                    (None, None, None,   0           [&#39;stage2_unit4_conv2[0][0]&#39;,     
                                128)                              &#39;add_5[0][0]&#39;]                  
                                                                                                  
 stage3_unit1_bn1 (BatchNormali  (None, None, None,   512        [&#39;add_6[0][0]&#39;]                  
 zation)                        128)                                                              
                                                                                                  
 stage3_unit1_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit1_bn1[0][0]&#39;]       
 )                              128)                                                              
                                                                                                  
 zero_padding2d_16 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit1_relu1[0][0]&#39;]     
 2D)                            128)                                                              
                                                                                                  
 stage3_unit1_conv1 (Conv2D)    (None, None, None,   294912      [&#39;zero_padding2d_16[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit1_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit1_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit1_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit1_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_17 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit1_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit1_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_17[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit1_sc (Conv2D)       (None, None, None,   32768       [&#39;stage3_unit1_relu1[0][0]&#39;]     
                                256)                                                              
                                                                                                  
 add_7 (Add)                    (None, None, None,   0           [&#39;stage3_unit1_conv2[0][0]&#39;,     
                                256)                              &#39;stage3_unit1_sc[0][0]&#39;]        
                                                                                                  
 stage3_unit2_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_7[0][0]&#39;]                  
 zation)                        256)                                                              
                                                                                                  
 stage3_unit2_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit2_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_18 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit2_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit2_conv1 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_18[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit2_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit2_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit2_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit2_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_19 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit2_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit2_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_19[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 add_8 (Add)                    (None, None, None,   0           [&#39;stage3_unit2_conv2[0][0]&#39;,     
                                256)                              &#39;add_7[0][0]&#39;]                  
                                                                                                  
 stage3_unit3_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_8[0][0]&#39;]                  
 zation)                        256)                                                              
                                                                                                  
 stage3_unit3_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit3_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_20 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit3_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit3_conv1 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_20[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit3_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit3_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit3_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit3_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_21 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit3_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit3_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_21[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 add_9 (Add)                    (None, None, None,   0           [&#39;stage3_unit3_conv2[0][0]&#39;,     
                                256)                              &#39;add_8[0][0]&#39;]                  
                                                                                                  
 stage3_unit4_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_9[0][0]&#39;]                  
 zation)                        256)                                                              
                                                                                                  
 stage3_unit4_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit4_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_22 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit4_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit4_conv1 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_22[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit4_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit4_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit4_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit4_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_23 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit4_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit4_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_23[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 add_10 (Add)                   (None, None, None,   0           [&#39;stage3_unit4_conv2[0][0]&#39;,     
                                256)                              &#39;add_9[0][0]&#39;]                  
                                                                                                  
 stage3_unit5_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_10[0][0]&#39;]                 
 zation)                        256)                                                              
                                                                                                  
 stage3_unit5_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit5_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_24 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit5_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit5_conv1 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_24[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit5_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit5_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit5_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit5_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_25 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit5_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit5_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_25[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 add_11 (Add)                   (None, None, None,   0           [&#39;stage3_unit5_conv2[0][0]&#39;,     
                                256)                              &#39;add_10[0][0]&#39;]                 
                                                                                                  
 stage3_unit6_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_11[0][0]&#39;]                 
 zation)                        256)                                                              
                                                                                                  
 stage3_unit6_relu1 (Activation  (None, None, None,   0          [&#39;stage3_unit6_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_26 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit6_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit6_conv1 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_26[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 stage3_unit6_bn2 (BatchNormali  (None, None, None,   1024       [&#39;stage3_unit6_conv1[0][0]&#39;]     
 zation)                        256)                                                              
                                                                                                  
 stage3_unit6_relu2 (Activation  (None, None, None,   0          [&#39;stage3_unit6_bn2[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_27 (ZeroPadding  (None, None, None,   0          [&#39;stage3_unit6_relu2[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage3_unit6_conv2 (Conv2D)    (None, None, None,   589824      [&#39;zero_padding2d_27[0][0]&#39;]      
                                256)                                                              
                                                                                                  
 add_12 (Add)                   (None, None, None,   0           [&#39;stage3_unit6_conv2[0][0]&#39;,     
                                256)                              &#39;add_11[0][0]&#39;]                 
                                                                                                  
 stage4_unit1_bn1 (BatchNormali  (None, None, None,   1024       [&#39;add_12[0][0]&#39;]                 
 zation)                        256)                                                              
                                                                                                  
 stage4_unit1_relu1 (Activation  (None, None, None,   0          [&#39;stage4_unit1_bn1[0][0]&#39;]       
 )                              256)                                                              
                                                                                                  
 zero_padding2d_28 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit1_relu1[0][0]&#39;]     
 2D)                            256)                                                              
                                                                                                  
 stage4_unit1_conv1 (Conv2D)    (None, None, None,   1179648     [&#39;zero_padding2d_28[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 stage4_unit1_bn2 (BatchNormali  (None, None, None,   2048       [&#39;stage4_unit1_conv1[0][0]&#39;]     
 zation)                        512)                                                              
                                                                                                  
 stage4_unit1_relu2 (Activation  (None, None, None,   0          [&#39;stage4_unit1_bn2[0][0]&#39;]       
 )                              512)                                                              
                                                                                                  
 zero_padding2d_29 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit1_relu2[0][0]&#39;]     
 2D)                            512)                                                              
                                                                                                  
 stage4_unit1_conv2 (Conv2D)    (None, None, None,   2359296     [&#39;zero_padding2d_29[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 stage4_unit1_sc (Conv2D)       (None, None, None,   131072      [&#39;stage4_unit1_relu1[0][0]&#39;]     
                                512)                                                              
                                                                                                  
 add_13 (Add)                   (None, None, None,   0           [&#39;stage4_unit1_conv2[0][0]&#39;,     
                                512)                              &#39;stage4_unit1_sc[0][0]&#39;]        
                                                                                                  
 stage4_unit2_bn1 (BatchNormali  (None, None, None,   2048       [&#39;add_13[0][0]&#39;]                 
 zation)                        512)                                                              
                                                                                                  
 stage4_unit2_relu1 (Activation  (None, None, None,   0          [&#39;stage4_unit2_bn1[0][0]&#39;]       
 )                              512)                                                              
                                                                                                  
 zero_padding2d_30 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit2_relu1[0][0]&#39;]     
 2D)                            512)                                                              
                                                                                                  
 stage4_unit2_conv1 (Conv2D)    (None, None, None,   2359296     [&#39;zero_padding2d_30[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 stage4_unit2_bn2 (BatchNormali  (None, None, None,   2048       [&#39;stage4_unit2_conv1[0][0]&#39;]     
 zation)                        512)                                                              
                                                                                                  
 stage4_unit2_relu2 (Activation  (None, None, None,   0          [&#39;stage4_unit2_bn2[0][0]&#39;]       
 )                              512)                                                              
                                                                                                  
 zero_padding2d_31 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit2_relu2[0][0]&#39;]     
 2D)                            512)                                                              
                                                                                                  
 stage4_unit2_conv2 (Conv2D)    (None, None, None,   2359296     [&#39;zero_padding2d_31[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 add_14 (Add)                   (None, None, None,   0           [&#39;stage4_unit2_conv2[0][0]&#39;,     
                                512)                              &#39;add_13[0][0]&#39;]                 
                                                                                                  
 stage4_unit3_bn1 (BatchNormali  (None, None, None,   2048       [&#39;add_14[0][0]&#39;]                 
 zation)                        512)                                                              
                                                                                                  
 stage4_unit3_relu1 (Activation  (None, None, None,   0          [&#39;stage4_unit3_bn1[0][0]&#39;]       
 )                              512)                                                              
                                                                                                  
 zero_padding2d_32 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit3_relu1[0][0]&#39;]     
 2D)                            512)                                                              
                                                                                                  
 stage4_unit3_conv1 (Conv2D)    (None, None, None,   2359296     [&#39;zero_padding2d_32[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 stage4_unit3_bn2 (BatchNormali  (None, None, None,   2048       [&#39;stage4_unit3_conv1[0][0]&#39;]     
 zation)                        512)                                                              
                                                                                                  
 stage4_unit3_relu2 (Activation  (None, None, None,   0          [&#39;stage4_unit3_bn2[0][0]&#39;]       
 )                              512)                                                              
                                                                                                  
 zero_padding2d_33 (ZeroPadding  (None, None, None,   0          [&#39;stage4_unit3_relu2[0][0]&#39;]     
 2D)                            512)                                                              
                                                                                                  
 stage4_unit3_conv2 (Conv2D)    (None, None, None,   2359296     [&#39;zero_padding2d_33[0][0]&#39;]      
                                512)                                                              
                                                                                                  
 add_15 (Add)                   (None, None, None,   0           [&#39;stage4_unit3_conv2[0][0]&#39;,     
                                512)                              &#39;add_14[0][0]&#39;]                 
                                                                                                  
 bn1 (BatchNormalization)       (None, None, None,   2048        [&#39;add_15[0][0]&#39;]                 
                                512)                                                              
                                                                                                  
 relu1 (Activation)             (None, None, None,   0           [&#39;bn1[0][0]&#39;]                    
                                512)                                                              
                                                                                                  
 decoder_stage0_upsampling (UpS  (None, None, None,   0          [&#39;relu1[0][0]&#39;]                  
 ampling2D)                     512)                                                              
                                                                                                  
 decoder_stage0_concat (Concate  (None, None, None,   0          [&#39;decoder_stage0_upsampling[0][0]
 nate)                          768)                             &#39;,                               
                                                                  &#39;stage4_unit1_relu1[0][0]&#39;]     
                                                                                                  
 decoder_stage0a_conv (Conv2D)  (None, None, None,   1769472     [&#39;decoder_stage0_concat[0][0]&#39;]  
                                256)                                                              
                                                                                                  
 decoder_stage0a_bn (BatchNorma  (None, None, None,   1024       [&#39;decoder_stage0a_conv[0][0]&#39;]   
 lization)                      256)                                                              
                                                                                                  
 decoder_stage0a_relu (Activati  (None, None, None,   0          [&#39;decoder_stage0a_bn[0][0]&#39;]     
 on)                            256)                                                              
                                                                                                  
 decoder_stage0b_conv (Conv2D)  (None, None, None,   589824      [&#39;decoder_stage0a_relu[0][0]&#39;]   
                                256)                                                              
                                                                                                  
 decoder_stage0b_bn (BatchNorma  (None, None, None,   1024       [&#39;decoder_stage0b_conv[0][0]&#39;]   
 lization)                      256)                                                              
                                                                                                  
 decoder_stage0b_relu (Activati  (None, None, None,   0          [&#39;decoder_stage0b_bn[0][0]&#39;]     
 on)                            256)                                                              
                                                                                                  
 decoder_stage1_upsampling (UpS  (None, None, None,   0          [&#39;decoder_stage0b_relu[0][0]&#39;]   
 ampling2D)                     256)                                                              
                                                                                                  
 decoder_stage1_concat (Concate  (None, None, None,   0          [&#39;decoder_stage1_upsampling[0][0]
 nate)                          384)                             &#39;,                               
                                                                  &#39;stage3_unit1_relu1[0][0]&#39;]     
                                                                                                  
 decoder_stage1a_conv (Conv2D)  (None, None, None,   442368      [&#39;decoder_stage1_concat[0][0]&#39;]  
                                128)                                                              
                                                                                                  
 decoder_stage1a_bn (BatchNorma  (None, None, None,   512        [&#39;decoder_stage1a_conv[0][0]&#39;]   
 lization)                      128)                                                              
                                                                                                  
 decoder_stage1a_relu (Activati  (None, None, None,   0          [&#39;decoder_stage1a_bn[0][0]&#39;]     
 on)                            128)                                                              
                                                                                                  
 decoder_stage1b_conv (Conv2D)  (None, None, None,   147456      [&#39;decoder_stage1a_relu[0][0]&#39;]   
                                128)                                                              
                                                                                                  
 decoder_stage1b_bn (BatchNorma  (None, None, None,   512        [&#39;decoder_stage1b_conv[0][0]&#39;]   
 lization)                      128)                                                              
                                                                                                  
 decoder_stage1b_relu (Activati  (None, None, None,   0          [&#39;decoder_stage1b_bn[0][0]&#39;]     
 on)                            128)                                                              
                                                                                                  
 decoder_stage2_upsampling (UpS  (None, None, None,   0          [&#39;decoder_stage1b_relu[0][0]&#39;]   
 ampling2D)                     128)                                                              
                                                                                                  
 decoder_stage2_concat (Concate  (None, None, None,   0          [&#39;decoder_stage2_upsampling[0][0]
 nate)                          192)                             &#39;,                               
                                                                  &#39;stage2_unit1_relu1[0][0]&#39;]     
                                                                                                  
 decoder_stage2a_conv (Conv2D)  (None, None, None,   110592      [&#39;decoder_stage2_concat[0][0]&#39;]  
                                64)                                                               
                                                                                                  
 decoder_stage2a_bn (BatchNorma  (None, None, None,   256        [&#39;decoder_stage2a_conv[0][0]&#39;]   
 lization)                      64)                                                               
                                                                                                  
 decoder_stage2a_relu (Activati  (None, None, None,   0          [&#39;decoder_stage2a_bn[0][0]&#39;]     
 on)                            64)                                                               
                                                                                                  
 decoder_stage2b_conv (Conv2D)  (None, None, None,   36864       [&#39;decoder_stage2a_relu[0][0]&#39;]   
                                64)                                                               
                                                                                                  
 decoder_stage2b_bn (BatchNorma  (None, None, None,   256        [&#39;decoder_stage2b_conv[0][0]&#39;]   
 lization)                      64)                                                               
                                                                                                  
 decoder_stage2b_relu (Activati  (None, None, None,   0          [&#39;decoder_stage2b_bn[0][0]&#39;]     
 on)                            64)                                                               
                                                                                                  
 decoder_stage3_upsampling (UpS  (None, None, None,   0          [&#39;decoder_stage2b_relu[0][0]&#39;]   
 ampling2D)                     64)                                                               
                                                                                                  
 decoder_stage3_concat (Concate  (None, None, None,   0          [&#39;decoder_stage3_upsampling[0][0]
 nate)                          128)                             &#39;,                               
                                                                  &#39;relu0[0][0]&#39;]                  
                                                                                                  
 decoder_stage3a_conv (Conv2D)  (None, None, None,   36864       [&#39;decoder_stage3_concat[0][0]&#39;]  
                                32)                                                               
                                                                                                  
 decoder_stage3a_bn (BatchNorma  (None, None, None,   128        [&#39;decoder_stage3a_conv[0][0]&#39;]   
 lization)                      32)                                                               
                                                                                                  
 decoder_stage3a_relu (Activati  (None, None, None,   0          [&#39;decoder_stage3a_bn[0][0]&#39;]     
 on)                            32)                                                               
                                                                                                  
 decoder_stage3b_conv (Conv2D)  (None, None, None,   9216        [&#39;decoder_stage3a_relu[0][0]&#39;]   
                                32)                                                               
                                                                                                  
 decoder_stage3b_bn (BatchNorma  (None, None, None,   128        [&#39;decoder_stage3b_conv[0][0]&#39;]   
 lization)                      32)                                                               
                                                                                                  
 decoder_stage3b_relu (Activati  (None, None, None,   0          [&#39;decoder_stage3b_bn[0][0]&#39;]     
 on)                            32)                                                               
                                                                                                  
 decoder_stage4_upsampling (UpS  (None, None, None,   0          [&#39;decoder_stage3b_relu[0][0]&#39;]   
 ampling2D)                     32)                                                               
                                                                                                  
 decoder_stage4a_conv (Conv2D)  (None, None, None,   4608        [&#39;decoder_stage4_upsampling[0][0]
                                16)                              &#39;]                               
                                                                                                  
 decoder_stage4a_bn (BatchNorma  (None, None, None,   64         [&#39;decoder_stage4a_conv[0][0]&#39;]   
 lization)                      16)                                                               
                                                                                                  
 decoder_stage4a_relu (Activati  (None, None, None,   0          [&#39;decoder_stage4a_bn[0][0]&#39;]     
 on)                            16)                                                               
                                                                                                  
 decoder_stage4b_conv (Conv2D)  (None, None, None,   2304        [&#39;decoder_stage4a_relu[0][0]&#39;]   
                                16)                                                               
                                                                                                  
 decoder_stage4b_bn (BatchNorma  (None, None, None,   64         [&#39;decoder_stage4b_conv[0][0]&#39;]   
 lization)                      16)                                                               
                                                                                                  
 decoder_stage4b_relu (Activati  (None, None, None,   0          [&#39;decoder_stage4b_bn[0][0]&#39;]     
 on)                            16)                                                               
                                                                                                  
 final_conv (Conv2D)            (None, None, None,   870         [&#39;decoder_stage4b_relu[0][0]&#39;]   
                                6)                                                                
                                                                                                  
 softmax (Activation)           (None, None, None,   0           [&#39;final_conv[0][0]&#39;]             
                                6)                                                                
                                                                                                  
==================================================================================================
Total params: 24,456,879
Trainable params: 24,439,529
Non-trainable params: 17,350
__________________________________________________________________________________________________
None
Epoch 1/100
49/49 [==============================] - 50s 403ms/step - loss: 1.0725 - accuracy: 0.6485 - jacard_coef: 0.3326 - val_loss: 5748.1616 - val_accuracy: 0.1557 - val_jacard_coef: 0.0980
Epoch 2/100
49/49 [==============================] - 13s 275ms/step - loss: 0.7110 - accuracy: 0.7653 - jacard_coef: 0.4835 - val_loss: 11844.3574 - val_accuracy: 0.3206 - val_jacard_coef: 0.1767
Epoch 3/100
49/49 [==============================] - 14s 276ms/step - loss: 0.5989 - accuracy: 0.7981 - jacard_coef: 0.5410 - val_loss: 32.4218 - val_accuracy: 0.4951 - val_jacard_coef: 0.3067
Epoch 4/100
49/49 [==============================] - 14s 277ms/step - loss: 0.5530 - accuracy: 0.8155 - jacard_coef: 0.5713 - val_loss: 45.2890 - val_accuracy: 0.4246 - val_jacard_coef: 0.2381
Epoch 5/100
49/49 [==============================] - 14s 278ms/step - loss: 0.5521 - accuracy: 0.8119 - jacard_coef: 0.5705 - val_loss: 5.0680 - val_accuracy: 0.7187 - val_jacard_coef: 0.4737
Epoch 6/100
49/49 [==============================] - 14s 279ms/step - loss: 0.4893 - accuracy: 0.8348 - jacard_coef: 0.6018 - val_loss: 0.6708 - val_accuracy: 0.7720 - val_jacard_coef: 0.5473
Epoch 7/100
49/49 [==============================] - 15s 306ms/step - loss: 0.4915 - accuracy: 0.8343 - jacard_coef: 0.6083 - val_loss: 0.5910 - val_accuracy: 0.7915 - val_jacard_coef: 0.5611
Epoch 8/100
49/49 [==============================] - 14s 281ms/step - loss: 0.4624 - accuracy: 0.8411 - jacard_coef: 0.6237 - val_loss: 0.8393 - val_accuracy: 0.7691 - val_jacard_coef: 0.5627
Epoch 9/100
49/49 [==============================] - 15s 309ms/step - loss: 0.4492 - accuracy: 0.8463 - jacard_coef: 0.6295 - val_loss: 1.0127 - val_accuracy: 0.7523 - val_jacard_coef: 0.5353
Epoch 10/100
49/49 [==============================] - 15s 310ms/step - loss: 0.4328 - accuracy: 0.8514 - jacard_coef: 0.6391 - val_loss: 0.6064 - val_accuracy: 0.7934 - val_jacard_coef: 0.5975
Epoch 11/100
49/49 [==============================] - 14s 284ms/step - loss: 0.4139 - accuracy: 0.8594 - jacard_coef: 0.6561 - val_loss: 0.5512 - val_accuracy: 0.8091 - val_jacard_coef: 0.5948
Epoch 12/100
49/49 [==============================] - 14s 284ms/step - loss: 0.4301 - accuracy: 0.8528 - jacard_coef: 0.6466 - val_loss: 0.7435 - val_accuracy: 0.7687 - val_jacard_coef: 0.5420
Epoch 13/100
49/49 [==============================] - 14s 283ms/step - loss: 0.4029 - accuracy: 0.8617 - jacard_coef: 0.6601 - val_loss: 0.5075 - val_accuracy: 0.8309 - val_jacard_coef: 0.6104
Epoch 14/100
49/49 [==============================] - 14s 287ms/step - loss: 0.3840 - accuracy: 0.8671 - jacard_coef: 0.6734 - val_loss: 0.6590 - val_accuracy: 0.7431 - val_jacard_coef: 0.4629
Epoch 15/100
49/49 [==============================] - 14s 286ms/step - loss: 0.3859 - accuracy: 0.8678 - jacard_coef: 0.6738 - val_loss: 15.3860 - val_accuracy: 0.7216 - val_jacard_coef: 0.5144
Epoch 16/100
49/49 [==============================] - 14s 287ms/step - loss: 0.3777 - accuracy: 0.8706 - jacard_coef: 0.6813 - val_loss: 0.5192 - val_accuracy: 0.8199 - val_jacard_coef: 0.6237
Epoch 17/100
49/49 [==============================] - 14s 286ms/step - loss: 0.3457 - accuracy: 0.8811 - jacard_coef: 0.6955 - val_loss: 0.4725 - val_accuracy: 0.8378 - val_jacard_coef: 0.6475
Epoch 18/100
49/49 [==============================] - 15s 313ms/step - loss: 0.3456 - accuracy: 0.8793 - jacard_coef: 0.7019 - val_loss: 0.4862 - val_accuracy: 0.8334 - val_jacard_coef: 0.6277
Epoch 19/100
49/49 [==============================] - 15s 312ms/step - loss: 0.3712 - accuracy: 0.8728 - jacard_coef: 0.6856 - val_loss: 377.9722 - val_accuracy: 0.5741 - val_jacard_coef: 0.3987
Epoch 20/100
49/49 [==============================] - 14s 285ms/step - loss: 0.3706 - accuracy: 0.8712 - jacard_coef: 0.6832 - val_loss: 0.4370 - val_accuracy: 0.8480 - val_jacard_coef: 0.6469
Epoch 21/100
49/49 [==============================] - 14s 288ms/step - loss: 0.3281 - accuracy: 0.8866 - jacard_coef: 0.7135 - val_loss: 0.4824 - val_accuracy: 0.8459 - val_jacard_coef: 0.6561
Epoch 22/100
49/49 [==============================] - 14s 287ms/step - loss: 0.3158 - accuracy: 0.8896 - jacard_coef: 0.7202 - val_loss: 0.4917 - val_accuracy: 0.8326 - val_jacard_coef: 0.6446
Epoch 23/100
49/49 [==============================] - 15s 315ms/step - loss: 0.3327 - accuracy: 0.8859 - jacard_coef: 0.7164 - val_loss: 0.4699 - val_accuracy: 0.8429 - val_jacard_coef: 0.6474
Epoch 24/100
49/49 [==============================] - 15s 313ms/step - loss: 0.2902 - accuracy: 0.8986 - jacard_coef: 0.7353 - val_loss: 0.4138 - val_accuracy: 0.8563 - val_jacard_coef: 0.6554
Epoch 25/100
49/49 [==============================] - 14s 287ms/step - loss: 0.3045 - accuracy: 0.8937 - jacard_coef: 0.7319 - val_loss: 0.5723 - val_accuracy: 0.8281 - val_jacard_coef: 0.6541
Epoch 26/100
49/49 [==============================] - 14s 289ms/step - loss: 0.2831 - accuracy: 0.9014 - jacard_coef: 0.7417 - val_loss: 0.4836 - val_accuracy: 0.8405 - val_jacard_coef: 0.6632
Epoch 27/100
49/49 [==============================] - 14s 293ms/step - loss: 0.2817 - accuracy: 0.9028 - jacard_coef: 0.7530 - val_loss: 0.4651 - val_accuracy: 0.8566 - val_jacard_coef: 0.6718
Epoch 28/100
49/49 [==============================] - 14s 292ms/step - loss: 0.2908 - accuracy: 0.8980 - jacard_coef: 0.7389 - val_loss: 0.6071 - val_accuracy: 0.8191 - val_jacard_coef: 0.6482
Epoch 29/100
49/49 [==============================] - 14s 290ms/step - loss: 0.2693 - accuracy: 0.9054 - jacard_coef: 0.7570 - val_loss: 0.5827 - val_accuracy: 0.8105 - val_jacard_coef: 0.6262
Epoch 30/100
49/49 [==============================] - 14s 291ms/step - loss: 0.2959 - accuracy: 0.8955 - jacard_coef: 0.7358 - val_loss: 0.5832 - val_accuracy: 0.8177 - val_jacard_coef: 0.6301
Epoch 31/100
49/49 [==============================] - 15s 316ms/step - loss: 0.2893 - accuracy: 0.8985 - jacard_coef: 0.7414 - val_loss: 2.2600 - val_accuracy: 0.7232 - val_jacard_coef: 0.5417
Epoch 32/100
49/49 [==============================] - 14s 289ms/step - loss: 0.2746 - accuracy: 0.9021 - jacard_coef: 0.7488 - val_loss: 0.6228 - val_accuracy: 0.8208 - val_jacard_coef: 0.6357
Epoch 33/100
49/49 [==============================] - 14s 291ms/step - loss: 0.2391 - accuracy: 0.9147 - jacard_coef: 0.7756 - val_loss: 0.5046 - val_accuracy: 0.8310 - val_jacard_coef: 0.6648
Epoch 34/100
49/49 [==============================] - 14s 289ms/step - loss: 0.2306 - accuracy: 0.9164 - jacard_coef: 0.7815 - val_loss: 0.4844 - val_accuracy: 0.8528 - val_jacard_coef: 0.6869
Epoch 35/100
49/49 [==============================] - 15s 316ms/step - loss: 0.2394 - accuracy: 0.9157 - jacard_coef: 0.7788 - val_loss: 0.5430 - val_accuracy: 0.8348 - val_jacard_coef: 0.6714
Epoch 36/100
49/49 [==============================] - 14s 291ms/step - loss: 0.2085 - accuracy: 0.9246 - jacard_coef: 0.8000 - val_loss: 0.5046 - val_accuracy: 0.8534 - val_jacard_coef: 0.6781
Epoch 37/100
49/49 [==============================] - 14s 290ms/step - loss: 0.2001 - accuracy: 0.9275 - jacard_coef: 0.8077 - val_loss: 0.5992 - val_accuracy: 0.8314 - val_jacard_coef: 0.6728
Epoch 38/100
49/49 [==============================] - 15s 317ms/step - loss: 0.2147 - accuracy: 0.9230 - jacard_coef: 0.7974 - val_loss: 0.4988 - val_accuracy: 0.8502 - val_jacard_coef: 0.6617
Epoch 39/100
49/49 [==============================] - 14s 290ms/step - loss: 0.1919 - accuracy: 0.9299 - jacard_coef: 0.8132 - val_loss: 0.5067 - val_accuracy: 0.8535 - val_jacard_coef: 0.7025
Epoch 40/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1744 - accuracy: 0.9363 - jacard_coef: 0.8269 - val_loss: 0.4839 - val_accuracy: 0.8584 - val_jacard_coef: 0.7100
Epoch 41/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1864 - accuracy: 0.9323 - jacard_coef: 0.8191 - val_loss: 0.5923 - val_accuracy: 0.8309 - val_jacard_coef: 0.6659
Epoch 42/100
49/49 [==============================] - 15s 317ms/step - loss: 0.2017 - accuracy: 0.9273 - jacard_coef: 0.8069 - val_loss: 0.5136 - val_accuracy: 0.8420 - val_jacard_coef: 0.6781
Epoch 43/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1652 - accuracy: 0.9396 - jacard_coef: 0.8342 - val_loss: 0.5123 - val_accuracy: 0.8549 - val_jacard_coef: 0.7096
Epoch 44/100
49/49 [==============================] - 14s 292ms/step - loss: 0.1561 - accuracy: 0.9427 - jacard_coef: 0.8450 - val_loss: 0.5506 - val_accuracy: 0.8512 - val_jacard_coef: 0.7058
Epoch 45/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1515 - accuracy: 0.9439 - jacard_coef: 0.8459 - val_loss: 0.5454 - val_accuracy: 0.8514 - val_jacard_coef: 0.7051
Epoch 46/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1434 - accuracy: 0.9468 - jacard_coef: 0.8547 - val_loss: 0.5453 - val_accuracy: 0.8522 - val_jacard_coef: 0.7101
Epoch 47/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1514 - accuracy: 0.9447 - jacard_coef: 0.8500 - val_loss: 0.5633 - val_accuracy: 0.8421 - val_jacard_coef: 0.6707
Epoch 48/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1745 - accuracy: 0.9361 - jacard_coef: 0.8310 - val_loss: 0.7353 - val_accuracy: 0.7951 - val_jacard_coef: 0.6298
Epoch 49/100
49/49 [==============================] - 14s 290ms/step - loss: 0.2095 - accuracy: 0.9239 - jacard_coef: 0.8043 - val_loss: 0.7068 - val_accuracy: 0.8251 - val_jacard_coef: 0.6709
Epoch 50/100
49/49 [==============================] - 15s 316ms/step - loss: 0.2206 - accuracy: 0.9200 - jacard_coef: 0.7965 - val_loss: 308.0538 - val_accuracy: 0.3081 - val_jacard_coef: 0.1787
Epoch 51/100
49/49 [==============================] - 14s 287ms/step - loss: 0.2755 - accuracy: 0.9033 - jacard_coef: 0.7579 - val_loss: 0.7392 - val_accuracy: 0.8086 - val_jacard_coef: 0.6217
Epoch 52/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1815 - accuracy: 0.9337 - jacard_coef: 0.8216 - val_loss: 0.5215 - val_accuracy: 0.8375 - val_jacard_coef: 0.6637
Epoch 53/100
49/49 [==============================] - 15s 315ms/step - loss: 0.1649 - accuracy: 0.9390 - jacard_coef: 0.8348 - val_loss: 0.4854 - val_accuracy: 0.8526 - val_jacard_coef: 0.7011
Epoch 54/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1404 - accuracy: 0.9476 - jacard_coef: 0.8563 - val_loss: 0.4794 - val_accuracy: 0.8551 - val_jacard_coef: 0.7032
Epoch 55/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1275 - accuracy: 0.9521 - jacard_coef: 0.8672 - val_loss: 0.4596 - val_accuracy: 0.8601 - val_jacard_coef: 0.7094
Epoch 56/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1293 - accuracy: 0.9513 - jacard_coef: 0.8679 - val_loss: 0.4706 - val_accuracy: 0.8556 - val_jacard_coef: 0.7041
Epoch 57/100
49/49 [==============================] - 15s 314ms/step - loss: 0.1246 - accuracy: 0.9531 - jacard_coef: 0.8694 - val_loss: 0.4918 - val_accuracy: 0.8624 - val_jacard_coef: 0.7263
Epoch 58/100
49/49 [==============================] - 15s 315ms/step - loss: 0.1211 - accuracy: 0.9544 - jacard_coef: 0.8758 - val_loss: 0.5741 - val_accuracy: 0.8417 - val_jacard_coef: 0.6941
Epoch 59/100
49/49 [==============================] - 14s 288ms/step - loss: 0.1148 - accuracy: 0.9564 - jacard_coef: 0.8788 - val_loss: 0.5485 - val_accuracy: 0.8602 - val_jacard_coef: 0.7277
Epoch 60/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1058 - accuracy: 0.9595 - jacard_coef: 0.8874 - val_loss: 0.5530 - val_accuracy: 0.8614 - val_jacard_coef: 0.7289
Epoch 61/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1028 - accuracy: 0.9606 - jacard_coef: 0.8911 - val_loss: 0.5430 - val_accuracy: 0.8614 - val_jacard_coef: 0.7296
Epoch 62/100
49/49 [==============================] - 15s 315ms/step - loss: 0.1130 - accuracy: 0.9575 - jacard_coef: 0.8830 - val_loss: 0.5566 - val_accuracy: 0.8593 - val_jacard_coef: 0.7277
Epoch 63/100
49/49 [==============================] - 15s 315ms/step - loss: 0.3602 - accuracy: 0.8825 - jacard_coef: 0.7286 - val_loss: 25595.9238 - val_accuracy: 0.1459 - val_jacard_coef: 0.0809
Epoch 64/100
49/49 [==============================] - 14s 288ms/step - loss: 0.3854 - accuracy: 0.8677 - jacard_coef: 0.6786 - val_loss: 0.6839 - val_accuracy: 0.8098 - val_jacard_coef: 0.6195
Epoch 65/100
49/49 [==============================] - 15s 316ms/step - loss: 0.2970 - accuracy: 0.8954 - jacard_coef: 0.7345 - val_loss: 0.6556 - val_accuracy: 0.7829 - val_jacard_coef: 0.5820
Epoch 66/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1981 - accuracy: 0.9271 - jacard_coef: 0.8052 - val_loss: 0.5772 - val_accuracy: 0.8237 - val_jacard_coef: 0.6525
Epoch 67/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1585 - accuracy: 0.9412 - jacard_coef: 0.8407 - val_loss: 0.9163 - val_accuracy: 0.7813 - val_jacard_coef: 0.6009
Epoch 68/100
49/49 [==============================] - 14s 289ms/step - loss: 0.1624 - accuracy: 0.9402 - jacard_coef: 0.8387 - val_loss: 0.5189 - val_accuracy: 0.8464 - val_jacard_coef: 0.6897
Epoch 69/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1351 - accuracy: 0.9492 - jacard_coef: 0.8607 - val_loss: 0.4946 - val_accuracy: 0.8540 - val_jacard_coef: 0.7065
Epoch 70/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1250 - accuracy: 0.9530 - jacard_coef: 0.8702 - val_loss: 0.5423 - val_accuracy: 0.8426 - val_jacard_coef: 0.6877
Epoch 71/100
49/49 [==============================] - 14s 290ms/step - loss: 0.1303 - accuracy: 0.9507 - jacard_coef: 0.8657 - val_loss: 0.5505 - val_accuracy: 0.8569 - val_jacard_coef: 0.7211
Epoch 72/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1176 - accuracy: 0.9557 - jacard_coef: 0.8769 - val_loss: 0.5206 - val_accuracy: 0.8508 - val_jacard_coef: 0.7094
Epoch 73/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1188 - accuracy: 0.9550 - jacard_coef: 0.8766 - val_loss: 0.5470 - val_accuracy: 0.8542 - val_jacard_coef: 0.7161
Epoch 74/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1117 - accuracy: 0.9575 - jacard_coef: 0.8830 - val_loss: 0.5585 - val_accuracy: 0.8539 - val_jacard_coef: 0.7186
Epoch 75/100
49/49 [==============================] - 14s 290ms/step - loss: 0.1061 - accuracy: 0.9593 - jacard_coef: 0.8880 - val_loss: 0.5384 - val_accuracy: 0.8575 - val_jacard_coef: 0.7243
Epoch 76/100
49/49 [==============================] - 14s 291ms/step - loss: 0.0998 - accuracy: 0.9617 - jacard_coef: 0.8938 - val_loss: 0.5642 - val_accuracy: 0.8590 - val_jacard_coef: 0.7283
Epoch 77/100
49/49 [==============================] - 15s 317ms/step - loss: 0.0978 - accuracy: 0.9624 - jacard_coef: 0.8948 - val_loss: 0.5630 - val_accuracy: 0.8577 - val_jacard_coef: 0.7271
Epoch 78/100
49/49 [==============================] - 16s 318ms/step - loss: 0.0915 - accuracy: 0.9645 - jacard_coef: 0.9018 - val_loss: 0.5853 - val_accuracy: 0.8561 - val_jacard_coef: 0.7265
Epoch 79/100
49/49 [==============================] - 16s 318ms/step - loss: 0.0914 - accuracy: 0.9646 - jacard_coef: 0.9020 - val_loss: 0.5691 - val_accuracy: 0.8554 - val_jacard_coef: 0.7224
Epoch 80/100
49/49 [==============================] - 14s 290ms/step - loss: 0.0881 - accuracy: 0.9658 - jacard_coef: 0.9049 - val_loss: 0.5725 - val_accuracy: 0.8582 - val_jacard_coef: 0.7301
Epoch 81/100
49/49 [==============================] - 14s 290ms/step - loss: 0.0856 - accuracy: 0.9668 - jacard_coef: 0.9078 - val_loss: 0.6077 - val_accuracy: 0.8564 - val_jacard_coef: 0.7276
Epoch 82/100
49/49 [==============================] - 15s 316ms/step - loss: 0.0831 - accuracy: 0.9675 - jacard_coef: 0.9101 - val_loss: 0.6056 - val_accuracy: 0.8581 - val_jacard_coef: 0.7311
Epoch 83/100
49/49 [==============================] - 15s 316ms/step - loss: 0.0802 - accuracy: 0.9687 - jacard_coef: 0.9130 - val_loss: 0.6759 - val_accuracy: 0.8494 - val_jacard_coef: 0.7175
Epoch 84/100
49/49 [==============================] - 15s 316ms/step - loss: 0.0806 - accuracy: 0.9687 - jacard_coef: 0.9121 - val_loss: 0.6278 - val_accuracy: 0.8569 - val_jacard_coef: 0.7320
Epoch 85/100
49/49 [==============================] - 15s 317ms/step - loss: 0.1114 - accuracy: 0.9584 - jacard_coef: 0.8902 - val_loss: 3.1873 - val_accuracy: 0.7699 - val_jacard_coef: 0.6147
Epoch 86/100
49/49 [==============================] - 14s 290ms/step - loss: 0.2100 - accuracy: 0.9234 - jacard_coef: 0.8049 - val_loss: 1.0381 - val_accuracy: 0.8091 - val_jacard_coef: 0.6696
Epoch 87/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1640 - accuracy: 0.9410 - jacard_coef: 0.8406 - val_loss: 0.6200 - val_accuracy: 0.8375 - val_jacard_coef: 0.6835
Epoch 88/100
49/49 [==============================] - 15s 316ms/step - loss: 0.1219 - accuracy: 0.9538 - jacard_coef: 0.8726 - val_loss: 0.5085 - val_accuracy: 0.8532 - val_jacard_coef: 0.7080
Epoch 89/100
49/49 [==============================] - 14s 290ms/step - loss: 0.1036 - accuracy: 0.9603 - jacard_coef: 0.8904 - val_loss: 0.5560 - val_accuracy: 0.8446 - val_jacard_coef: 0.7045
Epoch 90/100
49/49 [==============================] - 14s 289ms/step - loss: 0.0938 - accuracy: 0.9637 - jacard_coef: 0.9003 - val_loss: 0.5350 - val_accuracy: 0.8541 - val_jacard_coef: 0.7172
Epoch 91/100
49/49 [==============================] - 16s 318ms/step - loss: 0.0862 - accuracy: 0.9668 - jacard_coef: 0.9073 - val_loss: 0.5650 - val_accuracy: 0.8546 - val_jacard_coef: 0.7228
Epoch 92/100
49/49 [==============================] - 15s 315ms/step - loss: 0.0822 - accuracy: 0.9679 - jacard_coef: 0.9108 - val_loss: 0.5971 - val_accuracy: 0.8588 - val_jacard_coef: 0.7316
Epoch 93/100
49/49 [==============================] - 14s 289ms/step - loss: 0.0796 - accuracy: 0.9689 - jacard_coef: 0.9135 - val_loss: 0.5873 - val_accuracy: 0.8583 - val_jacard_coef: 0.7313
Epoch 94/100
49/49 [==============================] - 14s 290ms/step - loss: 0.0777 - accuracy: 0.9695 - jacard_coef: 0.9152 - val_loss: 0.6093 - val_accuracy: 0.8572 - val_jacard_coef: 0.7310
Epoch 95/100
49/49 [==============================] - 15s 315ms/step - loss: 0.0805 - accuracy: 0.9687 - jacard_coef: 0.9137 - val_loss: 0.7395 - val_accuracy: 0.8379 - val_jacard_coef: 0.7032
Epoch 96/100
49/49 [==============================] - 15s 317ms/step - loss: 0.0927 - accuracy: 0.9644 - jacard_coef: 0.9030 - val_loss: 0.6767 - val_accuracy: 0.8438 - val_jacard_coef: 0.7105
Epoch 97/100
49/49 [==============================] - 14s 290ms/step - loss: 0.0820 - accuracy: 0.9680 - jacard_coef: 0.9111 - val_loss: 0.6396 - val_accuracy: 0.8572 - val_jacard_coef: 0.7319
Epoch 98/100
49/49 [==============================] - 15s 315ms/step - loss: 0.0783 - accuracy: 0.9694 - jacard_coef: 0.9150 - val_loss: 0.6684 - val_accuracy: 0.8537 - val_jacard_coef: 0.7260
Epoch 99/100
49/49 [==============================] - 15s 316ms/step - loss: 0.0831 - accuracy: 0.9678 - jacard_coef: 0.9115 - val_loss: 0.7182 - val_accuracy: 0.8505 - val_jacard_coef: 0.7224
Epoch 100/100
49/49 [==============================] - 14s 290ms/step - loss: 0.0772 - accuracy: 0.9697 - jacard_coef: 0.9159 - val_loss: 0.6789 - val_accuracy: 0.8561 - val_jacard_coef: 0.7321
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book/3_ml4eo/3_sat_ml_deep"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-notebook-is-a-simple-semantic-segmentation-program-the-goal-is-to-build-and-train-a-model-which-is-able-to-automatically-label-each-pixel-in-an-aerial-image-with-its-semantic-category">This notebook is a simple semantic segmentation program. The goal is to build and train a model which is able to automatically label each pixel in an aerial image with its semantic category.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-dataset-we-use-consists-of-aerial-imagery-of-dubai-obtained-by-mbrsc-satellites-and-annotated-with-pixel-wise-semantic-segmentation-in-6-classes-the-total-volume-of-the-dataset-is-1305-256-256-images-grouped-into-6-larger-tiles-the-classes-are-building-land-unpaved-area-road-vegetation-water-unlabeled">The dataset we use consists of aerial imagery of Dubai obtained by MBRSC satellites and annotated with pixel-wise semantic segmentation in 6 classes. The total volume of the dataset is 1305 256*256 images grouped into 6 larger tiles. The classes are: Building, Land (unpaved area), Road, Vegetation, Water, Unlabeled.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-on-gpu">Run on GPU</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-python-library">Install Python library</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-dataset-from-github">Download Dataset from GitHub</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-current-working-directory">Set the Current Working Directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-train-validation-test-images-from-corresponding-subdirectory">Read train/ validation/ test images from corresponding subdirectory.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-array-integer-values-for-each-pixel-from-npy-file-to-be-used-as-labels">Read array (integer values for each pixel) from .npy file,  to be used as labels.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-model-u-net-based-model">Define the model: U-Net based model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-plotting-utilities">Model plotting utilities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configures-the-model-for-training">Configures the model for training.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-the-model-for-a-fixed-number-of-epochs-iterations-on-a-dataset">Train the model for a fixed number of epochs (iterations on a dataset).</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-training-and-validation-accuracy-and-loss-at-each-epoch">Plot the training and validation accuracy and loss at each epoch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-predictions">Visualize predictions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-1-finetune-the-segmentation-model">Exercises 1. Finetune the segmentation model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises-2-try-another-model">Exercises 2.Try another model</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SENSE CDT
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>